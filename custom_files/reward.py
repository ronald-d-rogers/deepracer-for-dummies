import math


def wrap_360(angle):
    angle = angle % 360
    angle = (angle + 360) % 360

    return angle


def convert_slope(m):
    radians = math.atan2(m[1], m[0])
    dir1 = radians
    dir2 = (radians + math.pi) % (2 * math.pi)

    return [dir1, dir2]


def get_distance(p1, p2):
    return math.sqrt((p1[0] - p2[0]) ** 2 + (p1[1] - p2[1]) ** 2)


def get_nearest_point(waypoints, point):
    min_i = None
    min_distance = math.inf

    for i, waypoint in enumerate(waypoints):
        distance = get_distance(waypoint, point)
        if distance < min_distance:
            min_i = i
            min_distance = distance

    return min_i


def get_best_position(waypoints, point):
    i1 = get_nearest_point(waypoints, point)
    p1 = waypoints[i1]

    i2 = i1 + 1
    if i2 > len(waypoints) - 1:
        i2 = 0

    p2 = waypoints[i2]
    m = [p2[0] - p1[0], p2[1] - p1[1]]

    return p1, m


# Chosen optimal waypoints for the track
track_waypoints = [[0.725, 2.5], [0.7270945945899505, 2.4862376841745637], [0.7292331525118089, 2.472498553596299], [0.7314158169177264, 2.4587831080758744], [0.7336427309598555, 2.4450918474239596], [0.7359140377903476, 2.431425271451222], [0.7382298805613546, 2.417783879968332], [0.7405904024250283, 2.404168172785958], [0.7429957465335203, 2.3905786497147687], [0.7454460560389827, 2.377015810565433], [0.7479414740935671, 2.3634801551486206], [0.7504821438494255, 2.3499721832749985], [0.7530682084587096, 2.3364923947552367], [0.755699811073571, 2.323041289400005], [0.7583770948461616, 2.309619367019971], [0.7611002029286333, 2.296227127425804], [0.763869278473138, 2.2828650704281728], [0.7666844646318273, 2.2695336958377466], [0.769545904556853, 2.2562335034651935], [0.7724537414003669, 2.2429649931211837], [0.7754081183145209, 2.2297286646163843], [0.7784091784514668, 2.2165250177614664], [0.7814570649633564, 2.2033545523670965], [0.7845519210023414, 2.190217768243945], [0.7876938897205734, 2.177115165202681], [0.7908831142702046, 2.1640472430539717], [0.7941197378033867, 2.151014501608488], [0.7974039034722714, 2.1380174406768977], [0.8007357544290107, 2.12505656006987], [0.8041154338257558, 2.112132359598073], [0.8075430848146593, 2.0992453390721773], [0.8110188505478725, 2.0863959983028497], [0.8145428741775473, 2.07358483710076], [0.8181152988558357, 2.0608123552765782], [0.821736267734889, 2.0480790526409716], [0.8254059239668595, 2.03538542900461], [0.8291244107038988, 2.022731984178161], [0.8328918710981587, 2.0101192179722953], [0.836708448301791, 1.9975476301976802], [0.8405742854669475, 1.9850177206649857], [0.84448952574578, 1.9725299891848802], [0.8484543122904403, 1.9600849355680328], [0.8524687882530803, 1.9476830596251122], [0.8565330967858515, 1.9353248611667873], [0.8606473810409061, 1.923010840003727], [0.8648117841703955, 1.9107414959465998], [0.8690264493264719, 1.8985173288060755], [0.8732915196612868, 1.886338838392822], [0.8776071383269921, 1.8742065245175088], [0.8819734484757396, 1.8621208869908044], [0.8863905932596811, 1.8500824256233783], [0.8908587158309683, 1.8380916402258987], [0.895377959341753, 1.8261490306090349], [0.8999484669441873, 1.8142550965834556], [0.9045703817904228, 1.8024103379598297], [0.9092438470326111, 1.7906152545488263], [0.9139690058229041, 1.778870346161114], [0.9187460013134539, 1.7671761126073617], [0.923574976656412, 1.7555330536982383], [0.9284560750039302, 1.743941669244413], [0.9333894395081603, 1.732402459056554], [0.9383752133212543, 1.7209159229453312], [0.9434135395953638, 1.7094825607214124], [0.9485045614826406, 1.6981028721954672], [0.9536484221352367, 1.686777357178164], [0.9588452647053037, 1.675506515480172], [0.9640952323449933, 1.6642908469121602], [0.9693984682064577, 1.653130851284797], [0.9747551154418482, 1.6420270284087524], [0.980165317203317, 1.6309798780946936], [0.9856292166430158, 1.6199899001532907], [0.9911469569130962, 1.6090575943952123], [0.9967186811657102, 1.5981834606311276], [1.0023445325530096, 1.5873679986717044], [1.0080246542271458, 1.5766117083276125], [1.0137591893402713, 1.5659150894095206], [1.0195482810445378, 1.5552786417280975], [1.025392072492096, 1.5447028650940127], [1.0312907068350992, 1.5341882593179337], [1.0372443272256981, 1.523735324210531], [1.0432530768160453, 1.5133445595824722], [1.0493170987582918, 1.5030164652444264], [1.05543653620459, 1.4927515410070633], [1.0616115323070918, 1.4825502866810512], [1.0678422302179482, 1.4724132020770588], [1.0741287730893119, 1.4623407870057554], [1.080471304073334, 1.4523335412778096], [1.086869966322167, 1.4423919647038903], [1.0933249029879624, 1.4325165570946663], [1.0998362572228715, 1.422707818260807], [1.1064041721790467, 1.412966248012981], [1.1130287910086394, 1.403292346161857], [1.1197102568638018, 1.3936866125181036], [1.1264487128966854, 1.3841495468923906], [1.133244302259442, 1.3746816490953861], [1.1400971681042236, 1.3652834189377592], [1.1470074535831818, 1.3559553562301792], [1.1539753018484689, 1.346697960783314], [1.1610008560522356, 1.3375117324078338], [1.168084259346635, 1.3283971709144062], [1.1752256548838178, 1.319354776113701], [1.1824251858159365, 1.3103850478163863], [1.1896829952951427, 1.301488485833132], [1.196999226473588, 1.2926655899746062], [1.2043740225034245, 1.2839168600514776], [1.211807526536804, 1.2752427958744161], [1.2192998817258778, 1.2666438972540894], [1.2268512312227986, 1.2581206640011675], [1.2344617181797175, 1.249673595926318], [1.242131485748786, 1.2413031928402112], [1.2498606770821568, 1.233009954553515], [1.2576494353319811, 1.2247943808768986], [1.2654979036504108, 1.2166569716210311], [1.2734062251895981, 1.208598226596581], [1.281374543101694, 1.2006186456142172], [1.289403000538851, 1.1927187284846086], [1.2974917406532205, 1.1848989750184247], [1.3056409065969548, 1.1771598850263332], [1.3138506415222049, 1.169501958319004], [1.3221210885811232, 1.1619256947071055], [1.3304523909258614, 1.154431594001307], [1.3388446917085715, 1.147020156012277], [1.3472981340814043, 1.1396918805506846], [1.355812861196513, 1.1324472674271981], [1.3643890162060486, 1.1252868164524872], [1.373026742262163, 1.1182110274372206], [1.3817261825170075, 1.111220400192067], [1.3904874801227352, 1.104315434527695], [1.3993107782314966, 1.0974966302547742], [1.4081962199954443, 1.0907644871839726], [1.4171439485667299, 1.0841195051259598], [1.4261541070975048, 1.0775621838914047], [1.4352268387399212, 1.0710930232909757], [1.4443622866461308, 1.0647125231353416], [1.4535605939682856, 1.0584211832351718], [1.462821903858537, 1.0522195034011352], [1.472146359469037, 1.0461079834439004], [1.4815341039519374, 1.0400871231741362], [1.4909852804593902, 1.0341574224025116], [1.500500032143547, 1.0283193809396958], [1.5100785021565595, 1.022573498596357], [1.5197208336505796, 1.0169202751831647], [1.5294271697777588, 1.0113602105107875], [1.5391976536902496, 1.0058938043898942], [1.5490324285402033, 1.0005215566311543], [1.5589314777398142, 0.9952437978819062], [1.5688939258794723, 0.9900599493041117], [1.5789186101786943, 0.9849691277362899], [1.5890043676519188, 0.9799704497997835], [1.5991500353135852, 0.975063032115936], [1.609354450178132, 0.970245991306091], [1.6196164492599983, 0.9655184439915914], [1.6299348695736224, 0.9608795067937803], [1.6403085481334436, 0.9563282963340015], [1.6507363219539006, 0.9518639292335979], [1.6612170280494327, 0.9474855221139127], [1.6717495034344783, 0.9431921915962893], [1.682332585123476, 0.9389830543020711], [1.692965110130865, 0.9348572268526012], [1.7036459154710843, 0.9308138258692227], [1.7143738381585725, 0.9268519679732792], [1.7251477152077688, 0.9229707697861137], [1.7359663836331116, 0.9191693479290696], [1.7468286804490396, 0.9154468190234902], [1.7577334426699924, 0.9118022996907185], [1.7686795073104085, 0.908234906552098], [1.7796657113847263, 0.9047437562289721], [1.7906908919073856, 0.9013279653426837], [1.8017538858928235, 0.8979866505145763], [1.8128535303554811, 0.894718928365993], [1.823988662309796, 0.8915239155182771], [1.8351581187702073, 0.8884007285927722], [1.8463607367511536, 0.8853484842108209], [1.8575953532670744, 0.8823662989937671], [1.8688608053324074, 0.8794532895629538], [1.8801559299615922, 0.8766085725397242], [1.8914795641690683, 0.8738312645454216], [1.9028305449692735, 0.8711204822013893], [1.9142077093766467, 0.8684753421289706], [1.9256098944056272, 0.8658949609495087], [1.9370359370706538, 0.8633784552843469], [1.9484846743861655, 0.8609249417548283], [1.9599549433666006, 0.8585335369822964], [1.9714455810263984, 0.8562033575880944], [1.9829554243799974, 0.8539335201935654], [1.9944833104418367, 0.8517231414200529], [2.0060280762263556, 0.8495713378889], [2.0175885587479923, 0.8474772262214498], [2.0291635950211853, 0.8454399230390462], [2.0407520220603743, 0.8434585449630317], [2.052352676879998, 0.84153220861475], [2.063964396494495, 0.8396600306155444], [2.075586017918303, 0.8378411275867578], [2.087216378165864, 0.8360746161497337], [2.0988543142516143, 0.8343596129258154], [2.1104986631899925, 0.8326952345363461], [2.1221482619954393, 0.8310805976026691], [2.1338019476823926, 0.8295148187461274], [2.145458557265291, 0.8279970145880649], [2.1571169277585738, 0.8265263017498241], [2.1687758961766788, 0.8251017968527489], [2.180434299534046, 0.823722616518182], [2.1920909748451147, 0.822387877367467], [2.2037447591243224, 0.8210966960219471], [2.2153944893861084, 0.8198481891029655], [2.2270390026449127, 0.8186414732318656], [2.238677135915172, 0.8174756650299907], [2.250307726211327, 0.8163498811186838], [2.2619296105478153, 0.8152632381192885], [2.2735416259390764, 0.8142148526531475], [2.2851426093995495, 0.8132038413416048], [2.2967313979436725, 0.8122293208060031], [2.3083068285858848, 0.8112904076676859], [2.3198677383406254, 0.8103862185479965], [2.3314129642223334, 0.8095158700682779], [2.342941343245447, 0.8086784788498736], [2.354451712424405, 0.8078731615141268], [2.365942908773646, 0.8070990346823809], [2.37741376930761, 0.8063552149759788], [2.3888631310407353, 0.8056408190162642], [2.40028983098746, 0.8049549634245801], [2.4116927061622246, 0.8042967648222699], [2.423070593579466, 0.8036653398306765], [2.4344223302536245, 0.8030598050711435], [2.445746753199139, 0.8024792771650142], [2.4570426994304473, 0.8019228727336318], [2.4683090059619888, 0.8013897083983393], [2.479544509808202, 0.8008789007804804], [2.4907480479835264, 0.800389566501398], [2.5019184595176265, 0.7999208226604879], [2.5130552133166106, 0.799471935776535], [2.524159299273291, 0.7990425331770316], [2.5352319322858596, 0.7986322955652817], [2.5462743272525117, 0.7982409036445896], [2.5572876990714395, 0.7978680381182597], [2.5682732626408358, 0.797513379689596], [2.5792322328588946, 0.797176609061903], [2.5901658246238104, 0.7968574069384847], [2.601075252833774, 0.7965554540226458], [2.6119617323869813, 0.7962704310176901], [2.6228264781816235, 0.7960020186269221], [2.6336707051158954, 0.795749897553646], [2.644495628087991, 0.795513748501166], [2.655302461996101, 0.7952932521727865], [2.666092421738422, 0.7950880892718117], [2.6768667222131453, 0.7948979405015457], [2.687626578318464, 0.794722486565293], [2.698373204952573, 0.7945614081663579], [2.709107817013664, 0.7944143860080444], [2.719831629399932, 0.7942811007936568], [2.7305458570095693, 0.7941612332264996], [2.7412517147407693, 0.7940544640098768], [2.7519504174917255, 0.7939604738470927], [2.762643180160632, 0.7938789434414516], [2.7733312176456812, 0.7938095534962579], [2.784015744845067, 0.7937519847148157], [2.7946979766569817, 0.7937059178004293], [2.8053791279796205, 0.7936710334564029], [2.8160604137111753, 0.793647012386041], [2.8267430487498406, 0.7936335352926475], [2.837428247993808, 0.7936302828795269], [2.848117226341272, 0.7936369358499834], [2.8588111986904265, 0.7936531749073211], [2.869511379939465, 0.7936786807548446], [2.8802189849865782, 0.793713134095858], [2.8909352287299632, 0.7937562156336655], [2.9016613260678104, 0.7938076060715712], [2.9123984918983146, 0.7938669861128798], [2.92314794111967, 0.7939340364608952], [2.933910888630067, 0.7940084378189217], [2.944688549327702, 0.7940898708902636], [2.9554821381107668, 0.7941780163782254], [2.9662928698774547, 0.7942725549861112], [2.9771219595259604, 0.7943731674172249], [2.987970621954476, 0.7944795343748712], [2.998840072061195, 0.7945913365623543], [3.0097315247443106, 0.7947082546829783], [3.020646194902018, 0.7948299694400477], [3.0315852974325077, 0.7949561615368664], [3.0425500472339744, 0.7950865116767389], [3.0535416592046127, 0.7952207005629696], [3.0645613482426133, 0.7953584088988624], [3.0756103292461723, 0.7954993173877218], [3.086689817113481, 0.795643106732852], [3.0978010267427334, 0.7957894576375574], [3.1089451730321245, 0.7959380508051419], [3.120123470879845, 0.7960885669389102], [3.13133713518409, 0.7962406867421661], [3.142587380843051, 0.7963940909182141], [3.1538754227549237, 0.7965484601703587], [3.165202475817901, 0.7967034752019039], [3.176569754930175, 0.7968588167161539], [3.1879784749899396, 0.7970141654164129], [3.1994298508953887, 0.7971692020059856], [3.2109250975447146, 0.7973236071881757], [3.222465429836112, 0.7974770616662878], [3.2340520626677733, 0.7976292461436261], [3.2456862109378926, 0.7977798413234948], [3.2573690895446625, 0.7979285279091983], [3.269101913386276, 0.7980749866040405], [3.2808858973609287, 0.7982188981113262], [3.292722256366811, 0.7983599431343592], [3.304612205302119, 0.7984978023764442], [3.3165569590650437, 0.798632156540885], [3.3285577325537803, 0.798762686330986], [3.3406157406665202, 0.7988890724500516], [3.352732198301458, 0.799010995601386], [3.364908320356788, 0.7991281364882933], [3.3771453217307017, 0.799240175814078], [3.3894444173213945, 0.7993467942820441], [3.401806822027057, 0.7994476725954962], [3.414233750745885, 0.7995424914577384], [3.4267264183760715, 0.7996309315720749], [3.439286039815808, 0.7997126736418098], [3.45191382996329, 0.7997873983702477], [3.4646110037167093, 0.7998547864606927], [3.4773787759742603, 0.7999145186164491], [3.4902183616341373, 0.7999662755408211], [3.503130976603169, 0.8000097402358114], [3.5161179691706232, 0.8000448974047843], [3.5291809504886067, 0.8000723308190746], [3.542321562729695, 0.8000926949460793], [3.5555414480664624, 0.800106644253196], [3.5688422486714804, 0.8001148332078217], [3.5822256067173277, 0.8001179162773537], [3.5956931643765744, 0.8001165479291894], [3.609246563821796, 0.8001113826307257], [3.622887447225569, 0.8001030748493603], [3.6366174567604643, 0.80009227905249], [3.6504382345990583, 0.8000796497075124], [3.664351422913924, 0.8000658412818246], [3.6783586638776358, 0.8000515082428237], [3.6924615996627685, 0.8000373050579073], [3.706661872441896, 0.8000238861944723], [3.720961124387593, 0.8000119061199162], [3.735360997672432, 0.8000020193016363], [3.749863134468989, 0.7999948802070295], [3.764469176949839, 0.7999911433034933], [3.7791807672875524, 0.799991463058425], [3.7939995476547077, 0.7999964939392216], [3.8089272611684932, 0.8000068441719651], [3.8239671785765004, 0.8000224221966417], [3.8391237554586044, 0.8000425936981576], [3.854401478388837, 0.8000667101634308], [3.86980483394123, 0.8000941230793791], [3.8853383086898137, 0.8001241839329206], [3.901006389208621, 0.8001562442109729], [3.9168135620716793, 0.8001896554004541], [3.932764313853024, 0.8002237689882818], [3.9488631311266866, 0.8002579364613743], [3.965114500466694, 0.8002915093066492], [3.9815229084470825, 0.8003238390110243], [3.99809284164188, 0.8003542770614176], [4.014828786625119, 0.8003821749447471], [4.03173522997083, 0.8004068841479304], [4.048816658253047, 0.8004277561578856], [4.066077558045797, 0.8004441424615305], [4.083522415923114, 0.8004553945457831], [4.10115571845903, 0.8004608638975609], [4.118981952227574, 0.8004599020037821], [4.137005603802778, 0.8004518603513646], [4.155231159758676, 0.8004360904272262], [4.173663106669295, 0.8004119437182845], [4.192305931108668, 0.8003787717114579], [4.211164119650828, 0.8003359258936639], [4.230242158869804, 0.8002827577518203], [4.249544535339628, 0.8002186187728454], [4.269075735634331, 0.8001428604436568], [4.288840246327946, 0.8000548342511724], [4.308842171170061, 0.7999542309877058], [4.329073763791861, 0.7998512444560523], [4.349513439256867, 0.7997683338741102], [4.370138829112063, 0.7997286529070399], [4.390927564904446, 0.7997553552200021], [4.411857278181006, 0.7998715944781569], [4.432907162425029, 0.8000993213390905], [4.454127161049181, 0.8004059946728481], [4.475665388054947, 0.8006834620956266], [4.497677188630386, 0.8008180017441118], [4.520317907963557, 0.8006958917549891], [4.543742891242517, 0.8002034102649441], [4.568091136791604, 0.7992390302292421], [4.593354126311794, 0.7978112725297815], [4.619445106972338, 0.7959870212878818], [4.6462766081754285, 0.7938336960816417], [4.673761159323268, 0.7914187164891584], [4.701811289818053, 0.7888095020885302], [4.730339529061976, 0.7860734724578554], [4.759258406457241, 0.7832780471752313], [4.7884804514060395, 0.7804906458187565], [4.817918193310568, 0.777778687966529], [4.847484161573031, 0.7752095931966463], [4.877180285829615, 0.772795855745834], [4.907470438644749, 0.7702661632890884], [4.938967255723235, 0.7672578070262128], [4.972283444403674, 0.763408034146937], [5.008031712024665, 0.7583540918409902], [5.046824765924811, 0.751733227298102], [5.089275313442713, 0.7431826877080011], [5.1359960619169645, 0.7323397202604194], [5.187599718686175, 0.7188415721450837], [5.244698991088946, 0.7023254905517232], [5.307905849124764, 0.6824292123015981], [5.377231402819452, 0.659189476501577], [5.4510009162486455, 0.6337625116849532], [5.527246196816806, 0.6074994168834044], [5.6039990519283895, 0.581751291128609], [5.6792912889878515, 0.5578692334522465], [5.751154715399647, 0.5372043428859951], [5.817632104658316, 0.5210998297594183], [5.8778161811518945, 0.5101435987487595], [5.932704631881448, 0.5035531770774583], [5.983496377331782, 0.5004013301626304], [6.031390337987694, 0.4997608234213949], [6.077542434439319, 0.5007369178292169], [6.122465462316786, 0.5029208919397835], [6.166177281994138, 0.5062780530717872], [6.208683030684284, 0.5107833235959626], [6.249987845600137, 0.516411625883044], [6.290096863954608, 0.5231378823037661], [6.329018059934799, 0.530935970168427], [6.36678423084558, 0.5397706226582158], [6.403441010970952, 0.5496018441770745], [6.439034142359607, 0.5603895994315047], [6.473609367060229, 0.5720938531280045], [6.507212427121517, 0.5846745699730784], [6.539889064592156, 0.5980917146732244], [6.571685021520835, 0.6123052519349429], [6.602646039956254, 0.6272751464647379], [6.632817861947098, 0.6429613629691071], [6.662246229542054, 0.6593238661545522], [6.690976884789818, 0.6763226207275741], [6.7190555697390835, 0.6939175913946748], [6.746528026438532, 0.7120687428623511], [6.77343999693686, 0.7307360398371077], [6.7998372232827595, 0.7498794470254452], [6.825751584982655, 0.7694648513100341], [6.851158466280967, 0.7894822747493542], [6.876018861427852, 0.809927886909275], [6.900293764670065, 0.8307978573571249], [6.923944170254365, 0.8520883556602366], [6.9469310724275015, 0.8737955513859339], [6.969215465436232, 0.895915614101547], [6.990758343527308, 0.918444713374404], [7.011520700947487, 0.9413790187718335], [7.031463531943521, 0.9647146998611635], [7.0505478307621665, 0.9884479262097228], [7.068734591650176, 1.0125748673848414], [7.085984808854304, 1.0370916929538423], [7.102259476621306, 1.0619945724840594], [7.117519589197938, 1.0872796755428207], [7.131726140830949, 1.1129431716974492], [7.144840125767101, 1.1389812305152813], [7.156824375764937, 1.1653896348565798], [7.16767139035509, 1.19215792395536], [7.177397672501786, 1.2192705854877404], [7.186020413849022, 1.2467119621961698], [7.193556806040791, 1.2744663968230978], [7.200024040721088, 1.3025182321109732], [7.205439309533904, 1.3308518108022451], [7.209819804123239, 1.359451475639363], [7.213182716133082, 1.3883015693647756], [7.21554523720743, 1.4173864347209344], [7.216924558990278, 1.4466904144502821], [7.217337873125618, 1.4761978512952745], [7.216802371257446, 1.5058930879983603], [7.215335245029755, 1.5357604673019847], [7.212953686086541, 1.5657843319485985], [7.209674886071797, 1.5959490246806514], [7.205516036629517, 1.6262388882405923], [7.200494329403696, 1.6566382653708704], [7.194626956038329, 1.6871314988139345], [7.187931108177409, 1.7177029313122343], [7.1804239774649306, 1.7483369056082185], [7.172122755544889, 1.7790177644443388], [7.163044634061277, 1.8097298505630395], [7.153206804658092, 1.84045750670677], [7.1426200095055234, 1.8711843205718361], [7.131225897303963, 1.9018857910150369], [7.118924183012372, 1.9325325076694198], [7.105613992375842, 1.9630949911881908], [7.09119445113946, 1.993543762224555], [7.075564685048318, 2.0238493414317182], [7.058623819847502, 2.0539822494628868], [7.040270981282101, 2.0839130069712675], [7.020405295097212, 2.11361213461006], [6.998925887037916, 2.143050153032476], [6.975731882849303, 2.172197582891722], [6.9507224082764685, 2.2010249448409964], [6.923796589064494, 2.229502759533514], [6.894853550958476, 2.2576015476224733], [6.863792419703502, 2.2852918297610807], [6.830512321044656, 2.312544126602548], [6.794912380727035, 2.339328958800074], [6.756891724495723, 2.365616847006867], [6.716349478095813, 2.3913783118761325], [6.673184767272389, 2.4165838740610774], [6.627296717770549, 2.4412040542149027], [6.578584455335376, 2.4652093729908193], [6.5269471057119555, 2.4885703510420325], [6.472294609721797, 2.5112584090143124], [6.4147856549438105, 2.533265667382487], [6.354827675714329, 2.554604946450438], [6.292838921446102, 2.5752899665146103], [6.229237641551859, 2.5953344478714557], [6.164442085444341, 2.6147521108174234], [6.098870502536312, 2.6335566756489546], [6.032941142240498, 2.6517618626625032], [5.9670722539696435, 2.6693813921545155], [5.901682087136492, 2.6864289844214397], [5.837188891153782, 2.7029183597597246], [5.774010915434265, 2.7188632384658167], [5.712566409390683, 2.734277340836163], [5.653273622435769, 2.749174387167214], [5.5964797414916, 2.7635688306223134], [5.5421951575765815, 2.77747859773826], [5.4903305849469515, 2.7909226430174967], [5.440796722652667, 2.803919921119293], [5.393504269743692, 2.8164893867029175], [5.348363925269994, 2.828649994427637], [5.305286388281521, 2.8404206989527245], [5.264182357828256, 2.8518204549374415], [5.224962532960149, 2.8628682170410604], [5.187537612727165, 2.8735829399228487], [5.151818296179267, 2.883983578242074], [5.117715282366419, 2.8940890866580053], [5.085139270338585, 2.9039184198299104], [5.054000959145727, 2.913490532417057], [5.024211047837809, 2.922824379078713], [4.995680235464789, 2.9319389144741486], [4.968319221076632, 2.940853093262631], [4.942038703723305, 2.9495858701034283], [4.916749382454767, 2.9581561996558077], [4.892361956320982, 2.9665830365790393], [4.868787124371915, 2.9748853355323894], [4.8459355856575215, 2.9830820511751295], [4.8237180392277725, 2.9911921381665234], [4.802045184132629, 2.9992345511658414], [4.780837699293631, 3.007226036230149], [4.760069511848097, 3.015171555284239], [4.739732236321525, 3.023072155933548], [4.719817498998461, 3.030928883181167], [4.700316926163451, 3.038742782030189], [4.681222144101043, 3.046514897483705], [4.662524779095778, 3.0542462745448073], [4.644216457432203, 3.061937958216589], [4.626288805394869, 3.06959099350214], [4.608733449268316, 3.0772064254045524], [4.591542015337093, 3.0847852989269193], [4.574706129885744, 3.0923286590723325], [4.558217419198816, 3.0998375508438825], [4.542067509560856, 3.1073130192446623], [4.526248027256409, 3.114756109277763], [4.510750598570022, 3.122167865946277], [4.495566849786237, 3.129549334253297], [4.480688407189604, 3.1369015592019136], [4.466106897064668, 3.1442255857952186], [4.451813945695973, 3.1515224590363045], [4.4378011793680665, 3.1587932239282637], [4.424060224365495, 3.166038925474187], [4.410582706972803, 3.1732606086771664], [4.397360253474538, 3.180459318540294], [4.384384490155244, 3.1876361000666624], [4.371647043299468, 3.1947919982593627], [4.359139551909443, 3.2019280573384834], [4.346854922420261, 3.209045243490677], [4.334788388864858, 3.2161443795968188], [4.322935434910654, 3.2232262731682604], [4.311291544225067, 3.230291731716355], [4.2998522004755175, 3.2373415627524573], [4.2886128873294265, 3.2443765737879167], [4.277569088454213, 3.2513975723340884], [4.266716287517292, 3.258405365902325], [4.256049968186089, 3.265400762003979], [4.24556561412802, 3.2723845681504034], [4.235258709010504, 3.2793575918529503], [4.225124736500963, 3.286320640622973], [4.215159180266816, 3.2932745219718242], [4.205357523975481, 3.3002200434108575], [4.195715251294377, 3.307158012451426], [4.186227845890926, 3.3140892366048806], [4.1768907914325455, 3.321014523382576], [4.167699571586656, 3.3279346802958636], [4.158649670020678, 3.3348505148560967], [4.149736570402026, 3.3417628345746304], [4.1409557563981245, 3.3486724469628126], [4.132302711676393, 3.355580159532001], [4.123772919904247, 3.3624867797935463], [4.11536186474911, 3.369393115258801], [4.107065029878398, 3.376299973439119], [4.0988778989595325, 3.383208161845852], [4.090795955659934, 3.3901184879903536], [4.08281468364702, 3.397031759383976], [4.074929566588211, 3.403948783538073], [4.067136088150924, 3.4108703679639967], [4.059429732002582, 3.4177973201731007], [4.051805981810603, 3.424730447676737], [4.044260321242407, 3.431670557986258], [4.036788233965413, 3.4386184586130177], [4.029385203647038, 3.4455749570683696], [4.022046713954706, 3.4525408608636647], [4.014768248555833, 3.4595169775102557], [4.007545291117841, 3.466504114519496], [4.000373325308147, 3.47350307940274], [3.993247834794172, 3.4805146796713387], [3.9861643032433354, 3.487539722836646], [3.9791182143230563, 3.4945790164100137], [3.9721050517007543, 3.501633367902795], [3.965120299043847, 3.5087035848263435], [3.9581594400197577, 3.5157904746920114], [3.9512179582959033, 3.5228948450111504], [3.944291337539704, 3.530017503295115], [3.937375061418579, 3.537159257055258], [3.9304646135999466, 3.544320913802932], [3.9235554837177475, 3.5515032787629393], [3.916644291693936, 3.558706723999692], [3.9097301161672045, 3.5659306793233374], [3.902812358891314, 3.573174450716602], [3.895890421620029, 3.580437344162213], [3.8889637061071154, 3.587718665642891], [3.8820316141063342, 3.5950177211413665], [3.8750935473714487, 3.6023338166403636], [3.8681489076562237, 3.609666258122608], [3.8611970967144207, 3.6170143515708246], [3.8542375162998055, 3.62437740296774], [3.847269568166141, 3.6317547182960785], [3.840292654067189, 3.6391456035385685], [3.8333061757567153, 3.6465493646779326], [3.826309534988481, 3.6539653076968994], [3.8193021335162514, 3.661392738578192], [3.8122833730937886, 3.6688309633045377], [3.805252655474857, 3.676279287858661], [3.79820938241322, 3.6837370182232885], [3.79115295566264, 3.6912034603811463], [3.784082776976882, 3.698677920314958], [3.7769982481097086, 3.706159704007451], [3.7698987708148834, 3.713648117441351], [3.7627837468461705, 3.721142466599382], [3.75565257795733, 3.7286420574642736], [3.748504665902131, 3.7361461960187468], [3.7413394124343338, 3.7436541882455288], [3.7341562193077005, 3.751165340127347], [3.7269544882759975, 3.7586789576469246], [3.7197336210929857, 3.76619434678699], [3.71249301951243, 3.7737108135302666], [3.705232085288094, 3.78122766385948], [3.697950220173741, 3.788744203757357], [3.690646825923133, 3.7962597392066244], [3.6833213042900352, 3.8037735761900056], [3.675973057028211, 3.8112850206902267], [3.668601485891423, 3.8187933786900143], [3.661205992633435, 3.826297956172093], [3.653785979008011, 3.833798059119188], [3.6463408467689113, 3.8412929935140294], [3.6388699976699046, 3.8487820653393365], [3.6313728334647517, 3.856264580577838], [3.6238487559072152, 3.8637398452122613], [3.6162971667510604, 3.871207165225328], [3.6087174677500484, 3.8786658465997683], [3.6011090606579446, 3.886115195318305], [3.5934713472285122, 3.893554517363664], [3.585803729215514, 3.90098311871857], [3.578105608372714, 3.9084003053657526], [3.5703763864538747, 3.915805383287934], [3.5626154652127617, 3.9231976584678403], [3.554822246403136, 3.930576436888198], [3.5469961317787626, 3.9379410245317326], [3.5391365230934055, 3.9452907273811686], [3.531242822100824, 3.952624851419235], [3.523314430554787, 3.9599427026286524], [3.515350750209056, 3.9672435869921503], [3.5073511828173927, 3.974526810492454], [3.499315130133563, 3.981791679112287], [3.491241993911329, 3.9890374988343784], [3.4831311759044534, 3.9962635756414504], [3.474982077866702, 4.003469215516231], [3.4667941015518373, 4.010653724441443], [3.45856664871362, 4.017816408399817], [3.450299121105818, 4.024956573374075], [3.4419909204821932, 4.032073525346943], [3.4336414485965077, 4.039166570301148], [3.425250107202526, 4.046235014219413], [3.4168162980540115, 4.0532781630844665], [3.408339422904726, 4.060295322879034], [3.399818883508437, 4.067285799585839], [3.3912540816189045, 4.074248899187608], [3.3826444189898925, 4.081183927667069], [3.373989297375165, 4.088090191006946], [3.3652881185284858, 4.094966995189963], [3.356540284203617, 4.101813646198848], [3.3477451961543236, 4.108629450016324], [3.338902256134369, 4.11541371262512], [3.3300108658975134, 4.122165740007962], [3.3210704271975255, 4.128884838147572], [3.312080341788166, 4.135570313026677], [3.3030400114231973, 4.142221470628003], [3.2939488378563855, 4.148837616934278], [3.284806222841491, 4.155418057928224], [3.2756115681322795, 4.16196209959257], [3.266364275482514, 4.168469047910037], [3.2570637466459584, 4.174938208863355], [3.2477093833763746, 4.181368888435249], [3.2383005874275264, 4.187760392608444], [3.2288367605531794, 4.194112027365664], [3.219317304507094, 4.2004230986896385], [3.2097416210430363, 4.2066929125630885], [3.2001091119147675, 4.212920774968744], [3.1904191788760525, 4.219105991889329], [3.1806712236806556, 4.225247869307567], [3.170864648082339, 4.231345713206186], [3.1609988538348643, 4.237398829567912], [3.151073242691999, 4.243406524375469], [3.141087216407503, 4.249368103611586], [3.131040176735141, 4.2552828732589845], [3.120931525428678, 4.261150139300392], [3.1107606642418744, 4.266969207718535], [3.1005269949284973, 4.272739384496137], [3.0902299192423066, 4.278459975615927], [3.079868838937069, 4.284130287060627], [3.0694431557665443, 4.2897496248129645], [3.0589522714844994, 4.295317294855665], [3.048395588596756, 4.300832603089697], [3.0377728363826395, 4.306294819891544], [3.0270845803958246, 4.311703124723922], [3.0163315180712673, 4.317056682712353], [3.0055143468439303, 4.322354658982359], [2.994633764148773, 4.327596218659462], [2.983690467420752, 4.332780526869187], [2.9726851540948287, 4.337906748737054], [2.9616185216059643, 4.342974049388586], [2.9504912673891157, 4.347981593949307], [2.939304088879245, 4.352928547544736], [2.92805768351131, 4.357814075300399], [2.916752748720271, 4.362637342341817], [2.905389981941089, 4.367397513794512], [2.8939700806087223, 4.372093754784007], [2.882493742158129, 4.3767252304358255], [2.87096166402427, 4.381291105875489], [2.8593745436421076, 4.385790546228519], [2.8477330784465966, 4.39022271662044], [2.836037965872702, 4.394586782176773], [2.824289903355378, 4.398881908023041], [2.8124895883295866, 4.403107259284766], [2.8006377182302895, 4.407262001087472], [2.7887349904924443, 4.411345298556679], [2.7767821025510093, 4.415356316817911], [2.764779751840946, 4.419294220996691], [2.7527286357972147, 4.42315817621854], [2.740629451854772, 4.426947347608982], [2.728482897448582, 4.430660900293538], [2.7162896700136017, 4.434297999397731], [2.704050466984787, 4.437857810047085], [2.6917659857971055, 4.441339497367119], [2.6794369238855116, 4.444742226483359], [2.6670639786849653, 4.448065162521326], [2.6546478476304283, 4.451307470606543], [2.6421892281568575, 4.454468315864531], [2.6296888176992135, 4.457546863420815], [2.6171473136924583, 4.460542278400914], [2.6045654135715504, 4.4634537259303535], [2.591943814771446, 4.466280371134655], [2.5792832147271074, 4.469021379139341], [2.566584310873497, 4.471675915069933], [2.553847800645569, 4.474243144051955], [2.541074379333382, 4.47672226505356], [2.5282647199643735, 4.479112828305791], [2.5154194823776743, 4.481414592126688], [2.502539326239844, 4.483627317557333], [2.4896249112174322, 4.485750765638811], [2.4766768969769895, 4.487784697412205], [2.463695943185072, 4.4897288739185965], [2.450682709508228, 4.491583056199071], [2.437637855613013, 4.493347005294709], [2.4245620411659807, 4.495020482246595], [2.411455925833681, 4.496603248095812], [2.398320169282666, 4.498095063883443], [2.38515543117949, 4.49949569065057], [2.3719623711907065, 4.500804889438277], [2.3587416489828645, 4.502022421287648], [2.345493924222521, 4.503148047239764], [2.332219856576226, 4.504181528335709], [2.318920105710529, 4.5051226256165675], [2.3055953312919892, 4.5059711001234195], [2.292246192987156, 4.5067267128973505], [2.278873350462579, 4.507389224979443], [2.2654774633848156, 4.50795839741078], [2.2520591914204147, 4.508433991232444], [2.23861919423593, 4.508815767485519], [2.2251581314979156, 4.509103487211086], [2.211676662872924, 4.509296911450232], [2.198175448027504, 4.509395801244035], [2.1846551466282107, 4.5093999176335835], [2.1711164183415987, 4.509309021659956], [2.1575599228342157, 4.5091228743642375], [2.14398631977262, 4.508841236787512], [2.1303962688233584, 4.508463869970859], [2.1167904296529865, 4.507990534955366], [2.103169461928058, 4.507420992782114], [2.089534025315124, 4.506755004492185], [2.0758847794807354, 4.505992331126663], [2.062222384091448, 4.505132733726633], [2.0485474988138113, 4.504175973333174], [2.034860783314379, 4.503121810987373], [2.021162897259705, 4.5019700077303115], [2.0074545003163413, 4.500720324603072], [1.9937362636536153, 4.499372506797601], [1.9800091860110456, 4.497925848162371], [1.9662746330712615, 4.496379136952255], [1.9525339899260787, 4.4947311346791325], [1.9387886416673197, 4.492980602854879], [1.925039973386798, 4.491126302991371], [1.911289370176334, 4.489166996600486], [1.8975382171277477, 4.487101445194101], [1.8837878993328547, 4.484928410284092], [1.8700398018834716, 4.482646653382337], [1.8562953098714179, 4.480254936000711], [1.8425558083885138, 4.477752019651092], [1.828822682526573, 4.475136665845356], [1.8150973173774179, 4.472407636095381], [1.8013810980328622, 4.469563691913043], [1.7876754095847265, 4.466603594810219], [1.7739816371248298, 4.463526106298786], [1.7603011657449887, 4.460329987890621], [1.7466353805370196, 4.4570140010975985], [1.7329856665927437, 4.453576907431598], [1.7193534090039755, 4.4500174684044955], [1.7057399928625345, 4.446334445528168], [1.6921468032602411, 4.442526600314492], [1.6785752252889095, 4.438592694275345], [1.6650266440403612, 4.434531488922601], [1.6515024446064104, 4.43034174576814], [1.6380040120788792, 4.4260222263238385], [1.6245327315495819, 4.421571692101572], [1.6110899881103398, 4.416988904613217], [1.5976771668529672, 4.412272625370652], [1.5842956528692842, 4.4074216158857515], [1.5709468312511106, 4.402434637670396], [1.5576320870902607, 4.397310452236458], [1.5443528054785562, 4.392047821095818], [1.531110371507813, 4.386645505760351], [1.5179061702698478, 4.381102267741932], [1.5047415868564795, 4.37541686855244], [1.4916180063595292, 4.3695880697037515], [1.4785368138708104, 4.363614632707744], [1.4654993944821448, 4.3574953190762935], [1.4525071332853474, 4.351228890321276], [1.4395637940237715, 4.344817111028034], [1.426676099103042, 4.338266335376468], [1.4138465584442277, 4.331578305576732], [1.4010775514483669, 4.3247546088437465], [1.3883714575165005, 4.3177968323924345], [1.3757306560496705, 4.310706563437716], [1.363157526448913, 4.3034853891945115], [1.3506544481152714, 4.296134896877743], [1.3382238004497835, 4.288656673702331], [1.325867962853486, 4.281052306883195], [1.313589314727425, 4.273323383635258], [1.3013902354726372, 4.26547149117344], [1.2892731044901604, 4.257498216712661], [1.277240301181038, 4.249405147467843], [1.2652942049463063, 4.241193870653906], [1.2534371951870065, 4.2328659734857705], [1.2416716513041803, 4.224423043178359], [1.2299999526988659, 4.215866666946594], [1.2184244787720993, 4.20719843200539], [1.2069476089249271, 4.198419925569675], [1.195571722558386, 4.1895327348543665], [1.184299199073514, 4.180538447074383], [1.1731324178713536, 4.171438649444652], [1.1620737583529421, 4.162234929180087], [1.1511255999193204, 4.152928873495614], [1.14029032197153, 4.143522069606153], [1.1295703039106086, 4.134016104726623], [1.1189679251375952, 4.124412566071946], [1.1084855650535308, 4.114713040857041], [1.0981256030594564, 4.104919116296834], [1.087890418556409, 4.095032379606241], [1.0777823909454312, 4.085054418000185], [1.0678038996275612, 4.0749868186935885], [1.0579573240038365, 4.064831168901365], [1.0482450434753017, 4.054589055838445], [1.0386694374429941, 4.044262066719744], [1.0292328853079522, 4.033851788760183], [1.0199377664712186, 4.023359809174686], [1.01078646033383, 4.012787715178169], [1.0017813462968275, 4.002137093985556], [0.9929245215859763, 3.9914094717865427], [0.984215999422168, 3.980605924069155], [0.9756548595349707, 3.969727324437965], [0.9672401772628068, 3.9587745455478878], [0.9589710279440982, 3.9477484600538384], [0.9508464869172634, 3.9366499406107276], [0.942865629520726, 3.9254798598734704], [0.9350275310929053, 3.91423909049698], [0.9273312669722203, 3.9029285051361664], [0.9197759124970966, 3.8915489764459488], [0.9123605430059523, 3.880101377081238], [0.9050842338372078, 3.8685865796969456], [0.8979460603292858, 3.857005456947989], [0.8909450978206054, 3.845358881489278], [0.8840804216495884, 3.8336477259757262], [0.8773511071546566, 3.8218728630622505], [0.87075622967423, 3.8100351654037623], [0.864294864546729, 3.7981355056551727], [0.8579660871105749, 3.7861747564713975], [0.8517689727041898, 3.7741537905073517], [0.8457025966659928, 3.762073480417944], [0.8397660343344067, 3.7499346988580937], [0.8339583610478504, 3.737738318482709], [0.8282786521447458, 3.725485211946705], [0.8227259829635148, 3.7131762519049976], [0.8172994288425774, 3.7008123110124984], [0.8119980651203538, 3.6883942619241195], [0.8068209671352663, 3.675922977294776], [0.8017672102257345, 3.66339932977938], [0.79683586973018, 3.6508241920328453], [0.7920260209870243, 3.6381984367100872], [0.7873367393346878, 3.625522936466018], [0.7827671001115908, 3.612798563955549], [0.7783161786561547, 3.600026191833596], [0.773983050306801, 3.5872066927550734], [0.7697667904019498, 3.5743409393748906], [0.7656664742800229, 3.5614298043479664], [0.7616811772794401, 3.5484741603292083], [0.757809974738623, 3.5354748799735334], [0.7540519419959929, 3.522432835935856], [0.7504061543899702, 3.509348900871088], [0.7468716872589755, 3.496223947434141], [0.7434476159414305, 3.483058848279932], [0.7401330157757553, 3.469854476063371], [0.7369269621003713, 3.4566117034393726], [0.7338285302537, 3.443331403062853], [0.730836795574161, 3.4300144475887215], [0.727950833400176, 3.4166617096718928], [0.7251697190701664, 3.4032740619672834], [0.7224925279225524, 3.3898523771298033], [0.719918335295755, 3.376397527814366], [0.7174462165281954, 3.362910386675887], [0.715075246958294, 3.349391826369277], [0.7128045019244722, 3.3358427195494498], [0.710633056765151, 3.3222639388713224], [0.708559986818751, 3.308656356989804], [0.7065843674236933, 3.2950208465598116], [0.7047052739183988, 3.2813582802362546], [0.7029217816412886, 3.2676695306740506], [0.701232965930783, 3.2539554705281093], [0.6996379021253037, 3.2402169724533474], [0.6981356655632712, 3.2264549091046746], [0.6967253315831063, 3.2126701531370068], [0.6954059755232307, 3.198863577205259], [0.6941766727220642, 3.1850360539643408], [0.6930364985180286, 3.1711884560691694], [0.6919845282495444, 3.1573216561746564], [0.6910198372550325, 3.143436526935713], [0.690141500872914, 3.1295339410072556], [0.6893485944416099, 3.1156147710441977], [0.6886401932995408, 3.10167988970145], [0.6880153727851281, 3.0877301696339305], [0.6874732082367923, 3.0737664834965472], [0.6870127749929545, 3.059789703944216], [0.6866331483920357, 3.045800703631854], [0.6863334037724566, 3.0318003552143695], [0.6861126164726383, 3.0177895313466765], [0.6859698618310017, 3.0037691046836894], [0.6859042151859677, 2.9897399478803237], [0.6859147518759572, 2.975702933591488], [0.6860005472393911, 2.9616589344721014], [0.6861606766146904, 2.9476088231770743], [0.686394215340276, 2.933553472361316], [0.686700238754569, 2.919493754679749], [0.6870778221959899, 2.9054305427872813], [0.68752604100296, 2.8913647093388253], [0.6880439705139001, 2.8772971269892977], [0.6886306860672311, 2.8632286683936083], [0.689285263001374, 2.849160206206673], [0.6900067766547495, 2.8350926130834067], [0.6907943023657788, 2.8210267616787204], [0.6916469154728828, 2.806963524647527], [0.6925636913144824, 2.79290377464474], [0.6935437052289983, 2.7788483843252756], [0.6945860325548517, 2.7647982263440443], [0.6956897486304633, 2.7507541733559613], [0.696853928794254, 2.7367170980159403], [0.6980776483846454, 2.7226878729788893], [0.6993599827400574, 2.7086673708997306], [0.7007000071989116, 2.694656464433373], [0.7020967970996288, 2.680656026234728], [0.7035494277806296, 2.666666928958713], [0.7050569745803356, 2.652690045260238], [0.7066185128371673, 2.6387262477942173], [0.7082331178895452, 2.6247764092155674], [0.7098998650758908, 2.6108414021791995], [0.7116178297346254, 2.5969220993400226], [0.7133860872041689, 2.5830193733529576], [0.7152037128229427, 2.569134096872916], [0.7170697819293681, 2.5552671425548077], [0.7189833698618653, 2.541419383053549], [0.7209435519588561, 2.527591691024052], [0.7229494035587607, 2.513784939121231], [0.725, 2.5]]


def reward_function(params):
    # Read input parameters
    is_reversed = params['is_reversed']
    all_wheels_on_track = params['all_wheels_on_track']
    track_width = params['track_width']
    distance_from_center = params['distance_from_center']
    # speed = params['speed']
    heading = params['heading']
    x = params['x']
    y = params['y']
    progress = params['progress']
    steps = params['steps']

    heading = wrap_360(heading)

    position = [x, y]

    # Give a very low reward by default
    reward = 1e-3

    # max_speed = 6
    best_position, slope = get_best_position(track_waypoints, [x, y])
    best_headings = [wrap_360(math.degrees(direction)) for direction in convert_slope(slope)]

    best_position_diff = get_distance(position, best_position)
    best_heading_diff = min([abs(heading - best_heading) for best_heading in best_headings])

    # Give a high reward if no wheels go off the track and
    # the agent is somewhere in between the track borders
    if not is_reversed and all_wheels_on_track and (0.5 * track_width - distance_from_center) >= 0.05:
        reward = 1.0

    if steps:
        # speed_reward = (1 + (speed / max_speed)) ** 2
        position_reward = (1 + (1 - math.tanh(best_position_diff))) ** 2
        heading_reward = (1 + (1 - best_heading_diff / 360)) ** 2
        # reward *= (position_reward * heading_reward + speed_reward) ** 2
        reward *= (position_reward * heading_reward) ** 2
        reward *= (progress / steps) ** 2

    # Always return a float value
    return float(reward)
