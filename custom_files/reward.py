import math


def wrap_360(angle):
    angle = angle % 360
    angle = (angle + 360) % 360

    return angle


def convert_slope(m):
    radians = math.atan2(m[1], m[0])
    dir1 = radians
    dir2 = (radians + math.pi) % (2 * math.pi)

    return [dir1, dir2]


def get_distance(p1, p2):
    return math.sqrt((p1[0] - p2[0]) ** 2 + (p1[1] - p2[1]) ** 2)


def get_nearest_point(waypoints, point):
    min_i = None
    min_distance = math.inf

    for i, waypoint in enumerate(waypoints):
        distance = get_distance(waypoint, point)
        if distance < min_distance:
            min_i = i
            min_distance = distance

    return min_i


def get_best_position(waypoints, point):
    i1 = get_nearest_point(waypoints, point)
    p1 = waypoints[i1]

    i2 = i1 + 1
    if i2 > len(waypoints) - 1:
        i2 = 0

    p2 = waypoints[i2]
    m = [p2[0] - p1[0], p2[1] - p1[1]]

    return p1, m


# Chosen optimal waypoints for the track

# re:Invent
# track_waypoints = [[1.0, 4.0], [1.038545548521668, 4.036820751749607], [1.078790252172949, 4.071959968191011], [1.1206453099848686, 4.105432203014689], [1.164021920988453, 4.137252009911126], [1.2088312842147277, 4.1674339425708], [1.25498459869472, 4.195992554684194], [1.302393063459455, 4.2229423999417905], [1.3509678775399594, 4.24829803203407], [1.4006202399672587, 4.272074004651511], [1.4512613497723805, 4.2942848714846], [1.5028024059863494, 4.314945186223813], [1.5551546076401916, 4.334069502559634], [1.6082291537649342, 4.351672374182544], [1.661937243391603, 4.367768354783026], [1.7161900755512236, 4.382371998051558], [1.7708988492748228, 4.395497857678622], [1.8259747635934265, 4.4071604873547034], [1.88132901753806, 4.417374440770275], [1.9368728101397505, 4.426154271615827], [1.9925173404295247, 4.433514533581836], [2.048173807438407, 4.439469780358785], [2.1037534101974242, 4.444034565637153], [2.159167347737603, 4.447223443107424], [2.21432681908997, 4.449050966460078], [2.269143023285549, 4.449531689385596], [2.3235271593553684, 4.44868016557446], [2.3773904263304537, 4.446510948717151], [2.43064402324183, 4.4430385925041485], [2.4831991491205248, 4.438277650625937], [2.534967002997564, 4.432242676772996], [2.585858783903973, 4.424948224635807], [2.6357856908707786, 4.416408847904853], [2.6846589229290068, 4.406639100270612], [2.7323896791096836, 4.395653535423566], [2.778889158443835, 4.383466707054199], [2.824068559962487, 4.370093168852989], [2.8678390826966664, 4.35554747451042], [2.910111925677399, 4.339844177716972], [2.9507982879357106, 4.322997832163126], [2.9898093685026286, 4.305022991539364], [3.027500085051433, 4.285776066139783], [3.064992215848914, 4.2648942647127495], [3.102364274282832, 4.2424395383077], [3.1396360921976973, 4.218496057342403], [3.176827501438024, 4.193147992234629], [3.2139583338483204, 4.166479513402151], [3.2510484212730986, 4.138574791262735], [3.2881175955568707, 4.1095179962341515], [3.3251856885441446, 4.0793932987341694], [3.362272532079437, 4.04828486918056], [3.3993979580072526, 4.016276877991091], [3.436581798172107, 3.9834534955835332], [3.47384388441851, 3.949898892375657], [3.5112040485909723, 3.9156972387852313], [3.5486821225340064, 3.880932705230027], [3.586297938092121, 3.84568946212781], [3.6240713271098306, 3.8100516798963553], [3.662022121431643, 3.774103528953428], [3.700170152902071, 3.7379291797168004], [3.7385352533656255, 3.701612802604242], [3.7771372546668185, 3.6652385680335215], [3.815995988650161, 3.62889064642241], [3.8551312871601615, 3.592653208188675], [3.894562982041334, 3.5566104237500875], [3.9343109051381884, 3.5208464635244177], [3.9743948882952367, 3.485445497929434], [4.01483476335699, 3.4504916973829074], [4.055650362167958, 3.4160692323026067], [4.096861516572653, 3.382262273106303], [4.138488058415586, 3.3491549902117637], [4.180549819541268, 3.3168315540367597], [4.22306663179421, 3.2853761349990602], [4.266058327018924, 3.2548729035164365], [4.30954473705992, 3.2254060300066563], [4.35354569376171, 3.19705968488749], [4.398081028968804, 3.169918038576708], [4.443170574525715, 3.144065261492079], [4.488834162276952, 3.119585524051373], [4.535091624067028, 3.0965629966723593], [4.581962791740453, 3.0750818497728085], [4.629467497141738, 3.0552262537704897], [4.677625572115395, 3.0370803790831724], [4.726456848505935, 3.020728396128627], [4.775981158157867, 3.006254475324623], [4.826283925283437, 2.9935254783378897], [4.877708532014386, 2.981369762044217], [4.93023082164391, 2.96955807839406], [4.983766805935603, 2.958041074365176], [5.038232496653057, 2.946769396935327], [5.09354390555987, 2.935693693082269], [5.149617044419634, 2.9247646097837645], [5.2063679249959405, 2.9139327940175717], [5.2637125590523866, 2.9031488927614495], [5.321566958352564, 2.8923635529931566], [5.37984713466007, 2.8815274216904547], [5.438469099738492, 2.870591145831101], [5.497348865351431, 2.8595053723928565], [5.556402443262475, 2.8482207483534783], [5.615545845235223, 2.836687920690729], [5.6746950830332645, 2.8248575363823636], [5.733766168420198, 2.812680242406146], [5.792675113159614, 2.8001066857398333], [5.851337929015105, 2.787087513361184], [5.909670627750271, 2.77357337224796], [5.967589221128697, 2.7595149093779177], [6.025009720913982, 2.744862771728817], [6.081848138869724, 2.729567606278421], [6.13802048675951, 2.713580060004484], [6.193442776346936, 2.6968507798847683], [6.248031019395596, 2.6793304128970328], [6.301701227669085, 2.660969606019036], [6.354369412930996, 2.6417190062285374], [6.405951586944924, 2.621529260503297], [6.456363761474459, 2.6003510158210736], [6.5055219482832, 2.5781349191596274], [6.553342159134738, 2.5548316174967174], [6.599740405792668, 2.5303917578101016], [6.644632700020582, 2.5047659870775414], [6.687935053582075, 2.477904952276795], [6.729563478240742, 2.449759300385622], [6.769433985760177, 2.4202796783817817], [6.807462587903971, 2.389416733243033], [6.84356529643572, 2.3571211119471362], [6.877658123119018, 2.32334346147185], [6.909657079717459, 2.2880344287949343], [6.939478177994635, 2.2511446608941474], [6.967037429714143, 2.2126248047472497], [6.992250846639573, 2.1724255073320005], [7.015034440534522, 2.1304974156261585], [7.035304223162583, 2.086791176607483], [7.052976206287351, 2.041257437253734], [7.067966401672416, 1.9938468445426705], [7.080190821081376, 1.9445100454520525], [7.089565476277823, 1.8931976869596383], [7.096006379025352, 1.839860416043187], [7.099429541087556, 1.7844488796804594], [7.099722187480578, 1.727176994852884], [7.096588109947553, 1.670502559786435], [7.090044783701655, 1.6150841956592084], [7.080187062225587, 1.5609784735405359], [7.0671097990020515, 1.5082419644997522], [7.050907847513761, 1.4569312396061909], [7.03167606124342, 1.4071028699291839], [7.009509293673732, 1.3588134265380643], [6.984502398287403, 1.3121194805021663], [6.9567502285671425, 1.2670776028908226], [6.926347637995655, 1.2237443647733666], [6.893389480055644, 1.182176337219131], [6.857970608229814, 1.1424300912974477], [6.820185876000878, 1.104562198077653], [6.780130136851537, 1.0686292286290784], [6.737898244264496, 1.0346877540210564], [6.693585051722463, 1.0027943453229213], [6.647285412708143, 0.9730055736040051], [6.599094180704245, 0.9453780099336423], [6.5491062091934715, 0.9199682253811654], [6.497416351658529, 0.8968327910159075], [6.444119461582125, 0.8760282779072018], [6.389310392446962, 0.8576112571243818], [6.33308399773575, 0.8416382997367802], [6.275535130931194, 0.8281659768137308], [6.216758645515997, 0.8172508594245662], [6.15684939497287, 0.8089495186386199], [6.095902232784513, 0.8033185255252246], [6.034012012433634, 0.800414451153714], [5.971550441249008, 0.8], [5.910534757098276, 0.8], [5.851272394017955, 0.8000000000000002], [5.793668348684264, 0.8], [5.737627617773427, 0.8], [5.683055197961664, 0.8], [5.629856085925198, 0.8], [5.577935278340251, 0.8000000000000002], [5.527197771883042, 0.8], [5.477548563229796, 0.8], [5.428892649056735, 0.8], [5.381135026040075, 0.8000000000000002], [5.334180690856047, 0.8], [5.287934640180864, 0.8], [5.242301870690752, 0.8000000000000003], [5.197187379061933, 0.8], [5.152496161970627, 0.8000000000000002], [5.108133216093057, 0.8], [5.064003538105444, 0.8000000000000002], [5.02001212468401, 0.8], [4.976063972504977, 0.8], [4.932064078244567, 0.8000000000000002], [4.887917438579, 0.8], [4.843529050184499, 0.8000000000000002], [4.798803909737286, 0.8], [4.753647013913584, 0.8000000000000002], [4.707963359389611, 0.8000000000000002], [4.6616579428415905, 0.8], [4.614635760945747, 0.8], [4.566801810378298, 0.8], [4.518061087815468, 0.8], [4.468318589933477, 0.8], [4.417479313408547, 0.8], [4.3654482549169025, 0.8], [4.312130411134762, 0.8], [4.257430778738348, 0.8000000000000002], [4.201254354403882, 0.8], [4.143506134807585, 0.8], [4.084091116625683, 0.8], [4.022914296534393, 0.8000000000000002], [3.9610054888776243, 0.7999999999999999], [3.9022549055784577, 0.8], [3.846667118570231, 0.8000000000000002], [3.793862114557832, 0.8000000000000002], [3.7434598802461463, 0.8], [3.695080402340061, 0.8], [3.648343667544466, 0.8000000000000002], [3.602869662564245, 0.7999999999999999], [3.5582783741042863, 0.8], [3.5141897888694755, 0.8], [3.470223893564701, 0.8000000000000002], [3.4260006748948504, 0.8000000000000002], [3.381140119564809, 0.8], [3.3352622142794646, 0.8], [3.287986945743702, 0.8], [3.2389343006624105, 0.8], [3.1877242657404783, 0.8], [3.1339768276827877, 0.8000000000000002], [3.0773119731942313, 0.8000000000000002], [3.0173496889796905, 0.7999999999999999], [2.9547722216883487, 0.8000779812886709], [2.892283578742447, 0.8004613667094017], [2.8301051070615486, 0.8011963465525603], [2.76830539136441, 0.8023179235276157], [2.7069530163697855, 0.8038611003440379], [2.64611656679642, 0.805860879711296], [2.5858646273630703, 0.8083522643388593], [2.526265782788484, 0.8113702569361969], [2.467388617791414, 0.8149498602127789], [2.409301717090613, 0.8191260768780736], [2.35207366540483, 0.8239339096415511], [2.2957730474528195, 0.8294083612126806], [2.240468447953329, 0.8355844343009312], [2.186228451625111, 0.8424971316157726], [2.13312164318692, 0.8501814558666735], [2.081216607357504, 0.8586724097631043], [2.0305819288556175, 0.8680049960145331], [1.981286192400007, 0.8782142173304306], [1.9333979827094279, 0.889335076420265], [1.886985884502632, 0.901402575993506], [1.8421184824983676, 0.9144517187596235], [1.798864361415388, 0.9285175074280861], [1.757292105972446, 0.943634944708363], [1.71747030088829, 0.9598390333099245], [1.6794675308816738, 0.9771647759422389], [1.6433523806713466, 0.9956471753147764], [1.6091934349760613, 1.0153212341370064], [1.5770592785145698, 1.0362219551183967], [1.547018496005622, 1.0583843409684186], [1.5191396721679709, 1.0818433943965402], [1.4934120369772375, 1.1067297682559392], [1.4682963428630051, 1.1349241124998475], [1.4432049303943935, 1.1669362337182418], [1.4181747652327106, 1.2024915100421802], [1.393242813039272, 1.2413153196027178], [1.3684460394753875, 1.2831330405309116], [1.34382141020237, 1.3276700509578179], [1.3194058908815331, 1.3746517290144902], [1.2952364471741866, 1.423803452831989], [1.2713500447416444, 1.4748506005413657], [1.2477836492452172, 1.5275185502736814], [1.2245742263462178, 1.5815326801599894], [1.2017587417059594, 1.6366183683313442], [1.1793741609857522, 1.6925009929188066], [1.1574574498469092, 1.7489059320534295], [1.1360455739507433, 1.805558563866267], [1.115175498958565, 1.8621842664883812], [1.0948841905316886, 1.9185084180508225], [1.0752086143314237, 1.9742563966846514], [1.056185736019084, 2.0291535805209224], [1.0378525212559822, 2.0829253476906895], [1.0202459357034286, 2.135297076325013], [1.0034029450227369, 2.185994144554945], [0.9873605148752183, 2.234741930511545], [0.9721556109221852, 2.2812658123258673], [0.9578251988249504, 2.3252911681289676], [0.9444062442448248, 2.366543376051904], [0.9319357128431217, 2.4047478142257304], [0.9204505702811525, 2.4396298607815052], [0.9099877822202294, 2.4709148938502836], [0.900584314321665, 2.498328291563121], [0.8918743479810104, 2.525587588337993], [0.8833929983642194, 2.5575251282488454], [0.8752027761748008, 2.593826220411803], [0.8673682372571417, 2.6341560595559015], [0.859953937455631, 2.678179840410175], [0.8530244326146553, 2.725562757703658], [0.8466442785786028, 2.7759700061653865], [0.8408780311918611, 2.8290667805243905], [0.8357902462988184, 2.8845182755097114], [0.831445479743862, 2.9419896858503773], [0.8279082873713797, 3.0011462062754273], [0.8252432250257591, 3.0616530315138952], [0.8235148485513883, 3.1231753562948112], [0.8227877137926553, 3.185378375347217], [0.8231263765939467, 3.2479272834001405], [0.8245953927996512, 3.3104872751826213], [0.8272593182541563, 3.3727235454236917], [0.8311827088018497, 3.4343012888523843], [0.8364301202871194, 3.494885700197739], [0.8430661085543527, 3.5541419741887843], [0.8511552294479376, 3.6117353055545602], [0.8607620388122621, 3.667330889024098], [0.8719510924917131, 3.7205939193264315], [0.8847869463306793, 3.7711895911905984], [0.8993341561735482, 3.818783099345632], [0.9156572778647067, 3.863039638520565], [0.9338208672485437, 3.903624403444434], [0.953889480169446, 3.940202588846273], [0.9759276724718022, 3.9724393894551167], [1.0, 4.0]]

# AWS Track
# track_waypoints = [[1.32, 3.95], [1.37019227178073, 3.96217369905346], [1.420318982632673, 3.9736059492755205], [1.4703833442189562, 3.9843330723583255], [1.5203885682027054, 3.994391389994016], [1.5703378662470469, 4.003817223874735], [1.6202344500151082, 4.01264689569263], [1.6700815311700155, 4.020916727139841], [1.7198823213748948, 4.02866303990851], [1.7696400322928727, 4.035922155690785], [1.8193578755870767, 4.042730396178804], [1.8690390629206322, 4.049124083064714], [1.9186868059566662, 4.055139538040657], [1.9683043163583058, 4.060813082798776], [2.017894805788677, 4.066181039031216], [2.0674614859109064, 4.0712797284301185], [2.1170075683881207, 4.076145472687628], [2.166536264883446, 4.080814593495887], [2.2160507870600092, 4.085323412547039], [2.2655543465809362, 4.089708251533225], [2.3150501551093554, 4.094005432146594], [2.3645414243083906, 4.098251276079283], [2.4140313658411707, 4.102482105023441], [2.4635231913708213, 4.106734240671207], [2.5130201125604685, 4.111044004714726], [2.56252534107324, 4.115447718846141], [2.6120420885722613, 4.119981704757596], [2.6615735667206595, 4.124682284141234], [2.7111229871815605, 4.129585778689197], [2.760693561618092, 4.13472851009363], [2.810288501693379, 4.140146800046677], [2.85991101907055, 4.1458769702404785], [2.90956432541273, 4.15195534236718], [2.959251632383046, 4.158418238118924], [3.0089761516446236, 4.165301979187854], [3.0587410948605918, 4.172642887266113], [3.1085496736940748, 4.180477284045844], [3.1584050998081996, 4.188841491219192], [3.2083105848660938, 4.197771830478299], [3.258269340530883, 4.2073046235153075], [3.3082845784656945, 4.217476192022364], [3.3583595103336537, 4.228322857691608], [3.408497347797888, 4.2398809422151835], [3.458674337324429, 4.2521892480290795], [3.507753050872641, 4.265375677584846], [3.555182010067808, 4.2794759971388885], [3.601031692899264, 4.294462121561218], [3.6453725773563432, 4.310305965721844], [3.6882751414283774, 4.326979444490777], [3.7298098631047014, 4.344454472738028], [3.770047220374649, 4.362702965333604], [3.809057691227554, 4.381696837147518], [3.8469117536527473, 4.401408003049778], [3.8836798856395647, 4.421808377910395], [3.919432565177339, 4.442869876599377], [3.954240270255403, 4.464564413986736], [3.9881734788630916, 4.486863904942481], [4.021302668989737, 4.509740264336622], [4.053698318624673, 4.533165407039169], [4.085430905757234, 4.557111247920133], [4.116570908376753, 4.581549701849522], [4.147188804472563, 4.606452683697347], [4.177355072033998, 4.6317921083336175], [4.207140189050392, 4.657539890628345], [4.236614633511074, 4.683667945451536], [4.265848883405386, 4.710148187673204], [4.294913416722654, 4.7369525321633565], [4.323878711452215, 4.764052893792004], [4.352815245583401, 4.791421187429158], [4.381793497105547, 4.819029327944827], [4.410883944007985, 4.8468492302090205], [4.440157064280049, 4.874852809091749], [4.469683335911074, 4.903011979463023], [4.4995332368903895, 4.931298656192849], [4.529777245207333, 4.959684754151244], [4.560485838851237, 4.988142188208212], [4.591729495811434, 5.016642873233764], [4.623578694077258, 5.045158724097911], [4.656103911638043, 5.073661655670663], [4.6893756264831215, 5.102123582822029], [4.723464316601827, 5.130516420422019], [4.758440459983494, 5.158812083340644], [4.7943745346174556, 5.186982486447912], [4.831337018493045, 5.2149995446138355], [4.869398389599596, 5.242835172708422], [4.90862912592644, 5.270461285601682], [4.949099705462913, 5.297849798163626], [4.990880606198351, 5.324972625264266], [5.034042306122082, 5.3518016817736065], [5.078655283223441, 5.3783088825616625], [5.1247900154917625, 5.404466142498442], [5.172516980916379, 5.4302453764539536], [5.221906657486627, 5.45561849929821], [5.273029523191836, 5.480557425901219], [5.325956056021342, 5.505034071132991], [5.380756733964478, 5.529020349863536], [5.437502035010578, 5.552488176962865], [5.496262437148973, 5.575409467300987], [5.557108418368998, 5.597756135747911], [5.620110456659987, 5.619500097173648], [5.685339030011272, 5.6406132664482085], [5.752864616412189, 5.6610675584416015], [5.822757693852072, 5.680834888023837], [5.895088740320249, 5.699887170064923], [5.969928233806058, 5.718196319434875], [6.047346652298833, 5.735734251003698], [6.127414473787905, 5.752472879641402], [6.210202176262608, 5.768384120217999], [6.295780237712276, 5.783439887603499], [6.384219136126242, 5.797612096667908], [6.473466143686316, 5.810191100543528], [6.559566805185242, 5.819942773750918], [6.642488877448871, 5.826960177542679], [6.722295683704663, 5.831367841718847], [6.79905054718009, 5.833290296079469], [6.872816791102614, 5.832852070424589], [6.9436577386997, 5.830177694554245], [7.011636713198814, 5.825391698268484], [7.07681703782742, 5.818618611367345], [7.139262035812989, 5.809982963650875], [7.1990350303829755, 5.799609284919113], [7.256199344764855, 5.787622104972103], [7.31081830218609, 5.774145953609888], [7.362955225874141, 5.759305360632508], [7.412673439056482, 5.74322485584001], [7.460036264960571, 5.726028969032434], [7.505107026813876, 5.707842230009822], [7.547949047843865, 5.688789168572218], [7.588625651277997, 5.668994314519665], [7.627200160343744, 5.648582197652205], [7.663735898268566, 5.627677347769881], [7.698296188279931, 5.606404294672734], [7.730944353605306, 5.584887568160809], [7.761743717472154, 5.563251698034147], [7.790757603107939, 5.541621214092792], [7.818049333740129, 5.520120646136785], [7.843682232596188, 5.49887452396617], [7.867719622903582, 5.478007377380989], [7.890224827889776, 5.457643736181285], [7.911261170782234, 5.4379081301671], [7.930891974808426, 5.418925089138478], [7.949180563195812, 5.400819142895459], [7.966430338175393, 5.382353628267566], [7.982948306816361, 5.3619725999186105], [7.998729463515613, 5.339718289152466], [8.013768205901258, 5.315636141224843], [8.028058931601407, 5.289771601391454], [8.041596038244165, 5.262170114908008], [8.054373923457648, 5.232877127030218], [8.066386984869963, 5.201938083013795], [8.07762962010922, 5.169398428114447], [8.08809622680353, 5.135303607587889], [8.097781202581004, 5.099699066689828], [8.106678945069747, 5.062630250675976], [8.114783851897872, 5.024142604802045], [8.12209032069349, 4.984281574323747], [8.128592749084708, 4.943092604496788], [8.134285534699638, 4.900621140576882], [8.139163075166389, 4.856912627819741], [8.14321976811307, 4.812012511481074], [8.14645001116779, 4.76596623681659], [8.148848201958664, 4.718819249082005], [8.150408738113796, 4.6706169935330255], [8.151126017261301, 4.621404915425365], [8.150994437029285, 4.5712284600147335], [8.150008395045857, 4.520133072556841], [8.148162288939131, 4.4681641983074], [8.145450516337213, 4.415367282522118], [8.141867474868215, 4.36178777045671], [8.137407562160249, 4.307471107366885], [8.13206517584142, 4.2524627385083535], [8.125834713539842, 4.1968081091368274], [8.118710572883622, 4.140552664508016], [8.110687151500871, 4.083741849877633], [8.101758847019699, 4.026421110501383], [8.091920057068215, 3.9686358916349844], [8.081165179274528, 3.910431638534145], [8.06948861126675, 3.8518537964545745], [8.05688475067299, 3.7929478106519854], [8.043347995121358, 3.733759126382088], [8.028872742239965, 3.6743331889005932], [8.01345338965692, 3.614715443463211], [7.997084335000331, 3.5549513353256534], [7.979759975898309, 3.495086309743631], [7.961474709978965, 3.4351658119728543], [7.942222934870408, 3.375235287269034], [7.921999048200746, 3.315340180887881], [7.9007974475980935, 3.2555259380851074], [7.878612530690557, 3.1958380041164225], [7.855438695106244, 3.1363218242375357], [7.831270338473271, 3.0770228437041625], [7.806101858419742, 3.0179865077720107], [7.77992765257377, 2.9592582616967915], [7.752742118563463, 2.9008835507342163], [7.724539654016933, 2.8429078201399953], [7.695314656562287, 2.7853765151698386], [7.665061523827637, 2.7283350810794595], [7.633774653441092, 2.6718289631245673], [7.601448443030762, 2.615903606560872], [7.568077290224758, 2.560604456644086], [7.533655592651188, 2.505976958629919], [7.498177747938161, 2.4520665577740828], [7.461638153713791, 2.398918699332288], [7.424031207606184, 2.3465788285602454], [7.38535130724345, 2.2950923907136636], [7.3456003869840405, 2.2445022910771666], [7.305522743277556, 2.194593354915114], [7.265606824479482, 2.145211132656319], [7.225842204398439, 2.096364216269783], [7.186218456843044, 2.0480611977245076], [7.146725155621926, 2.000310668989495], [7.107351874543708, 1.9531212220337486], [7.068088187417005, 1.9065014488262693], [7.028923668050446, 1.8604599413360603], [6.989847890252651, 1.8150052915321229], [6.950850427832244, 1.7701460913834601], [6.911920854597849, 1.7258909328590741], [6.8730487443580826, 1.682248407927966], [6.834223670921572, 1.6392271085591397], [6.795435208096938, 1.5968356267215946], [6.756672929692803, 1.5550825543843363], [6.717926409517792, 1.5139764835163663], [6.679185221380523, 1.473526006086685], [6.640438939089625, 1.433739714064297], [6.601677136453714, 1.394626199418202], [6.562889387281415, 1.356194054117404], [6.524065265381351, 1.318451870130905], [6.485194344562146, 1.2814082394277069], [6.446266198632416, 1.2450717539768112], [6.40727040140079, 1.2094510057472216], [6.368196526675891, 1.1745545867079392], [6.329034148266334, 1.140391088827966], [6.289772839980748, 1.1069691040763054], [6.250402175627757, 1.0742972244219593], [6.210911729015975, 1.0423840418339276], [6.171291073954032, 1.011238148281216], [6.1315297842505485, 0.9808681357328249], [6.091617433714149, 0.9512825961577576], [6.051543596153452, 0.9224901215250153], [6.011297845377081, 0.8944993038036002], [5.970869755193659, 0.867318734962515], [5.93024889941181, 0.8409570069707618], [5.889424851840155, 0.8154227117973425], [5.848387186287316, 0.7907244414112596], [5.807125476561917, 0.7668707877815152], [5.765629296472578, 0.7438703428771117], [5.7238882198279235, 0.7217316986670512], [5.681891820436577, 0.7004634471203357], [5.639629672107159, 0.680074180205968], [5.5970913486482905, 0.6605724898929488], [5.554266423868597, 0.6419669681502824], [5.511144471576702, 0.62426620694697], [5.467715065581224, 0.607478798252014], [5.423967779690788, 0.5916133340344163], [5.379892187714017, 0.5766784062631793], [5.335477863459531, 0.5626826069073054], [5.290714380735954, 0.5496345279357966], [5.245591313351909, 0.5375427613176551], [5.200098235116017, 0.5264158990218832], [5.154224719836902, 0.5162625330174831], [5.107960341323185, 0.507091255273457], [5.0612946733834905, 0.49891065775880716], [5.014217289826439, 0.4917293324425357], [4.966717764460654, 0.48555587129364486], [4.918785671094756, 0.48039886628113676], [4.870410583537371, 0.47626690937401406], [4.821582075597119, 0.47316859254127847], [4.772289721082625, 0.4711125077519325], [4.722523093802509, 0.4701072469749783], [4.6723968760782055, 0.47022760442326195], [4.6225143143461525, 0.471780964058331], [4.572940452458177, 0.4747533033970203], [4.523656704495833, 0.4790841676207007], [4.474644484540677, 0.4847131019107428], [4.425885206674262, 0.491579651448517], [4.377360284978144, 0.4996233614153938], [4.329051133533877, 0.5087837769927442], [4.280939166423013, 0.5190004433619384], [4.233005797727111, 0.5302129057043471], [4.185232441527724, 0.5423607092013415], [4.137600511906404, 0.5553833990342908], [4.0900914229447105, 0.5692205203845666], [4.0426865887241945, 0.5838116184335395], [3.9953674233264094, 0.5990962383625792], [3.9481153408329144, 0.6150139253530572], [3.9009117553252617, 0.631504224586344], [3.853738080885002, 0.6485066812438096], [3.806575731593697, 0.6659608405068251], [3.759406121532897, 0.683806247556761], [3.712210664784157, 0.7019824475749877], [3.664970775429032, 0.720428985742876], [3.617667867549077, 0.7390854072417962], [3.570283355225846, 0.7578912572531193], [3.5227986525408936, 0.7767860809582154], [3.475195173575773, 0.7957094235384563], [3.427454332412042, 0.8146008301752106], [3.379557543131254, 0.83339984604985], [3.331486219814962, 0.8520460163437451], [3.283221776544723, 0.8704788862382662], [3.2347456274020896, 0.8886380009147841], [3.1860391864686166, 0.9064629055546694], [3.1370838678258597, 0.9238931453392925], [3.0878610855553728, 0.940868265450024], [3.03835225373871, 0.9573278110682347], [2.9885387864574264, 0.973211327375295], [2.9384216730892114, 0.9884637293712736], [2.888479750053041, 1.0031870224160433], [2.8389091718019377, 1.0174725238733064], [2.7896881916710154, 1.0313619386863757], [2.7407950629953786, 1.0448969717985632], [2.69220803911014, 1.05811932815318], [2.6439053733504103, 1.0710707126935386], [2.595865319051296, 1.0837928303629516], [2.5480661295479075, 1.0963273861047307], [2.500486058175355, 1.1087160848621884], [2.4531033582687467, 1.1210006315786358], [2.4058962831631923, 1.1332227311973861], [2.3588430861938017, 1.1454240886617513], [2.311922020695684, 1.1576464089150431], [2.265111340003948, 1.1699313969005734], [2.2183892974537023, 1.182320757561655], [2.171734146380061, 1.1948561958415986], [2.125124140118127, 1.2075794166837184], [2.078537532003016, 1.2205321250313244], [2.0319525753698318, 1.2337560258277305], [1.9853475235536886, 1.247292824016247], [1.9387006298896912, 1.2611842245401879], [1.8919901477129537, 1.2754719323428634], [1.8451943303585803, 1.290197652367587], [1.798291431161687, 1.3054030895576698], [1.7512597034573758, 1.3211299488564254], [1.7040774005807628, 1.3374199352071638], [1.6567227758669512, 1.3543147535531994], [1.6091740826510539, 1.371856108837843], [1.5614095742681835, 1.3900857060044056], [1.513407504053442, 1.4090452499962016], [1.4651461253419464, 1.4287764457565406], [1.4166036914687994, 1.4493209982287376], [1.3677584557691163, 1.4707206123561016], [1.3185886715780004, 1.4930169930819477], [1.269072592230568, 1.5162518453495848], [1.219188471061921, 1.5404668741023286], [1.1695872612153417, 1.5663259879753133], [1.122809051022123, 1.5961126647303643], [1.079008034104492, 1.6297454602509278], [1.0380779717115896, 1.6668948975570492], [0.9999126250925686, 1.7072314996687648], [0.9644057554965694, 1.7504257896061188], [0.931451124172742, 1.796148290389151], [0.9009424923702348, 1.8440695250378965], [0.8727736213381904, 1.8938600165724035], [0.8468382723257596, 1.9451902880127059], [0.8230302065820847, 1.9977308623788501], [0.8012431853563164, 2.05115226269087], [0.7813709698975981, 2.1051250119688136], [0.7633073214550787, 2.1593196332327125], [0.7469460012779033, 2.213406649502616], [0.7321807706152201, 2.2670565837985572], [0.7189053907161741, 2.319939959140583], [0.7070136228299135, 2.371727298548728], [0.6963992282055835, 2.422089125043038], [0.6869559680923322, 2.4706959616435475], [0.678577603739305, 2.5172183313703034], [0.6711578963956488, 2.5613267572433425], [0.6645906073105114, 2.602691762282703], [0.6587694977330381, 2.6409838695084304], [0.6535883289123763, 2.675873601940561], [0.6489384906342743, 2.7072503574264584], [0.6447282223239332, 2.7400960862970134], [0.6410814129162135, 2.7763768682227807], [0.6381738748521606, 2.8157949679105108], [0.6361814205728198, 2.8580526500669636], [0.6352798625192365, 2.902852179398888], [0.6356450131324556, 2.9498958206130435], [0.6374526848535227, 2.9988858384161805], [0.640878690123483, 3.0495244975150593], [0.6460988413833815, 3.101514062616427], [0.6532889510742643, 3.1545567984270475], [0.6626248316371763, 3.2083549696536706], [0.6742822955131619, 3.262610841003047], [0.688437155143268, 3.31702667718194], [0.7052652229685377, 3.371304742897096], [0.724942311430019, 3.425147302855277], [0.7476442329687544, 3.4782566217632316], [0.7735468000257921, 3.5303349643277206], [0.8028258250421738, 3.581084595255492], [0.8356571204589491, 3.630207779253308], [0.8722164987171588, 3.6774067810279156], [0.9126797722578527, 3.7223838652860777], [0.957222753522071, 3.7648412967345406], [1.006021254950865, 3.804481340080067], [1.0592510889852729, 3.8410062600294044], [1.1170880680663478, 3.8741183212893127], [1.1797080046351314, 3.9035197885665456], [1.2472867111326638, 3.9289129265678553], [1.32, 3.95]]

# Tokyo Training Track
track_waypoints = [[1.7, -1.3], [1.7026314473455593, -1.2433596118691543], [1.710199392480573, -1.1862533337665093], [1.7222142400525469, -1.1291390179783556], [1.7381863947089862, -1.072474516790984], [1.7576262610973963, -1.0167176824906845], [1.7800442438652815, -0.9623263673637479], [1.8049507476601487, -0.909758423696465], [1.8318561771295017, -0.859471703775126], [1.860270936920846, -0.8119240598860212], [1.8897054316816873, -0.7675733443154413], [1.9196700660595303, -0.7268774093496769], [1.9496752447018804, -0.6902941072750182], [1.9792313722562431, -0.658281290377756], [2.007848853370123, -0.6312968109441806], [2.0350380926910265, -0.6097985212605825], [2.060647994817448, -0.5937440051720809], [2.087215606490195, -0.5791846036463909], [2.1153338267765167, -0.5651656509504767], [2.1449672349758866, -0.5516722629083493], [2.1760804103877787, -0.5386895553440196], [2.2086379323116643, -0.5262026440814983], [2.2426043800470166, -0.5141966449447964], [2.277944332893308, -0.502656673757925], [2.3146223701500124, -0.4915678463448944], [2.3526030711166013, -0.4809152785297158], [2.3918510150925494, -0.4706840861363998], [2.4323307813773276, -0.46085938498895734], [2.4740069492704087, -0.4514262909113994], [2.516844098071268, -0.44236991972773687], [2.5608068070793757, -0.43367538726198035], [2.6058596555942053, -0.42532780933814074], [2.6519672229152307, -0.417312301780229], [2.6990940883419237, -0.40961398041225583], [2.747204831173756, -0.4022179610582321], [2.796264030710204, -0.3951093595421689], [2.846236266250737, -0.3882732916880767], [2.8970861170948288, -0.38169487331996654], [2.9487781625419536, -0.37535922026184954], [3.0012769818915825, -0.3692514483377359], [3.0545471544431884, -0.36335667337163696], [3.1085532594962464, -0.3576600111875634], [3.1632598763502253, -0.35214657760952595], [3.2186315843046014, -0.3468014884615358], [3.2746329626588486, -0.34160985956760354], [3.3312285907124344, -0.3365568067517401], [3.388383047764835, -0.33162744583795606], [3.4460609131155246, -0.32680689265026275], [3.504226766063973, -0.32208026301267056], [3.5628451859096555, -0.3174326727491906], [3.6218807519520424, -0.31284923768383366], [3.6812980434906093, -0.30831507364061056], [3.741061639824827, -0.3038152964435321], [3.801136120254169, -0.2993350219166092], [3.8614860640781083, -0.29485936588385264], [3.922076050596118, -0.2903734441692734], [3.9828706591076695, -0.28586237259688213], [4.043834468912237, -0.2813112669906898], [4.104932059309293, -0.2767052431747072], [4.166128009598311, -0.27202941697294514], [4.227386899078763, -0.2672689042094146], [4.28867330705012, -0.2624088207081265], [4.349951812811858, -0.25743428229309134], [4.411186995663448, -0.25233040478832014], [4.4723434349043645, -0.2470823040178238], [4.533385709834078, -0.24167509580561308], [4.594278399752063, -0.23609389597569902], [4.654986083957792, -0.23032382035209215], [4.715473341750738, -0.22434998475880352], [4.775704752430373, -0.2181575050198439], [4.835644895296172, -0.21173149695922416], [4.8952583496476025, -0.20505707640095533], [4.954509694784143, -0.19811935916904794], [5.013363510005265, -0.19090346108751297], [5.07178437461044, -0.18339449798036117], [5.12973686789914, -0.1755775856716035], [5.187185569170841, -0.16743783998525097], [5.244095057725014, -0.1589603767453141], [5.300429912861131, -0.15013031177580385], [5.356154713878665, -0.14093276090073106], [5.411234040077091, -0.1313528399441068], [5.46563247075588, -0.12137566472994149], [5.519314585214506, -0.11098635108224625], [5.572244962752441, -0.10017001482503178], [5.624388182669157, -0.0889117717823091], [5.675708824264127, -0.07719673777808903], [5.726171466836826, -0.06501002863638228], [5.7757406896867245, -0.05233676018119973], [5.824381072113297, -0.039162048236552255], [5.8720571934160155, -0.025471008626450714], [5.918733632894352, -0.011248757174906199], [5.96437496984778, 0.003519590294070951], [6.008945783575772, 0.018848917956469646], [6.052410653377803, 0.034754109988279075], [6.094734158553343, 0.05125005056548834], [6.135880878401865, 0.06835162386408627], [6.1758153922228445, 0.08607371406006273], [6.214502279315751, 0.10443120532940649], [6.251906118980061, 0.12343898184810678], [6.287991490515244, 0.14311192779215265], [6.322722973220773, 0.16346492733753315], [6.356065146396124, 0.1845128646602378], [6.387982589340766, 0.2062706239362555], [6.418439881354174, 0.2287530893415755], [6.4474016017358196, 0.2519751450521869], [6.474832329785177, 0.27595167524407843], [6.5006963220037335, 0.30069837977631536], [6.524542872821323, 0.32732110321729996], [6.546065534913029, 0.35671852178541974], [6.565377026013903, 0.3887673173933127], [6.582590063858999, 0.4233441719536165], [6.597817366183363, 0.4603257673789682], [6.61117165072205, 0.49958878558200687], [6.622765635210113, 0.5410099084753696], [6.632712037382602, 0.584465817971694], [6.641123574974566, 0.6298331959836182], [6.6481129657210625, 0.6769887244237788], [6.653792927357136, 0.7258090852048149], [6.658276177617845, 0.7761709602393644], [6.661675434238236, 0.827951031440064], [6.664103414953362, 0.881025980719552], [6.665672837498277, 0.9352724899904652], [6.66649641960803, 0.9905672411654433], [6.666686879017671, 1.0467869161571224], [6.666356933462257, 1.1038081968781412], [6.665619300676835, 1.1615077652411367], [6.664586698396457, 1.2197623031587463], [6.663371844356178, 1.2784484925436093], [6.662087456291045, 1.3374430153083623], [6.660846251936112, 1.396622553365644], [6.659760949026429, 1.4558637886280907], [6.65894426529705, 1.5150434030083402], [6.658508918483028, 1.5740380784190322], [6.658567626319408, 1.632724496772803], [6.659233106541248, 1.6909793399822903], [6.660618076883596, 1.7486792899601324], [6.6628352550815055, 1.8057010286189659], [6.665997358870027, 1.86192123787143], [6.670217105984213, 1.9172165996301622], [6.675607214159114, 1.9714637958077996], [6.682280401129782, 2.0245395083169804], [6.69034938463127, 2.076320419070341], [6.699926882398627, 2.1266832099805213], [6.711125612166906, 2.1755045629601586], [6.724058291671159, 2.2226611599218895], [6.738837638646436, 2.268029682778353], [6.755576370827791, 2.3114868134421847], [6.774387205950273, 2.352909233826025], [6.795382861748935, 2.39217362584251], [6.819494116639321, 2.4295305241151857], [6.84826459116654, 2.4656269706335667], [6.881318125952596, 2.5003318719986516], [6.918219293365901, 2.5334885921945633], [6.958532665774857, 2.5649404952054264], [7.00182281554788, 2.594530945015364], [7.047654315053373, 2.6221033056084986], [7.095591736659747, 2.6475009409689534], [7.145199652735411, 2.670567215080852], [7.196042635648775, 2.6911454919283178], [7.247685257768243, 2.709079135495474], [7.299692091462228, 2.724211509766443], [7.351627709099137, 2.73638597872535], [7.403056683047381, 2.7454459063563164], [7.453681676645197, 2.751326306031433], [7.505671112653796, 2.7555705899251177], [7.559502854621922, 2.7585330974443893], [7.614642586824436, 2.759887136592241], [7.670555993536199, 2.759306015371667], [7.726708759032076, 2.7564630417856635], [7.782566567586921, 2.751031523837225], [7.8375951034756035, 2.742684769529345], [7.891260050972981, 2.7310960868650187], [7.943027094353916, 2.7159387838472417], [7.99236191789327, 2.6968861684790073], [8.038730205865901, 2.6736115487633114], [8.081597642546676, 2.6457882327031474], [8.12042991221045, 2.6130895283015114], [8.15469269913209, 2.5751887435613967], [8.183851687586454, 2.531759186485799], [8.207619945612318, 2.4827739804599354], [8.228715724588051, 2.431752067800083], [8.24808672721324, 2.3798651493218546], [8.265807446992964, 2.3272034761073805], [8.2819523774323, 2.2738572992387893], [8.296596012036334, 2.2199168697982117], [8.309812844310152, 2.165472438867777], [8.32167736775883, 2.110614257529614], [8.332264075887451, 2.0554325768658517], [8.341647462201099, 2.0000176479586185], [8.349902020204855, 1.9444597218900463], [8.357102243403798, 1.8888490497422643], [8.363322625303011, 1.8332758825973976], [8.368637659407582, 1.777830471537579], [8.373121839222588, 1.7226030676449366], [8.376849658253107, 1.6676839220015993], [8.379895610004226, 1.6131632856896974], [8.382334187981026, 1.5591314097913593], [8.38423988568859, 1.5056785453887154], [8.385687196631999, 1.4528949435638934], [8.386750614316334, 1.4008708553990241], [8.387504632246676, 1.3496965319762375], [8.388023743928109, 1.2994622243776595], [8.388382442865716, 1.2502581836854212], [8.388655222564577, 1.202174660981652], [8.388916576529772, 1.1553019073484811], [8.389240998266384, 1.1097301738680376], [8.389702981279498, 1.0655497116224508], [8.390377019074194, 1.0228507716938502], [8.391337605155552, 0.9817236051643646], [8.39265923302866, 0.9422584631161239], [8.39441639619859, 0.9045455966312579], [8.396683588170433, 0.8686752567918938], [8.399535302449264, 0.834737694680162], [8.402704222009618, 0.801194443931479], [8.4056391279874, 0.7653726416115201], [8.408329602043707, 0.7273371882976162], [8.410774709746208, 0.6871994988990476], [8.412973516662563, 0.645070988325094], [8.41492508836045, 0.6010630714850358], [8.416628490407536, 0.5552871632881532], [8.418082788371484, 0.5078546786437264], [8.419287047819974, 0.4588770324610373], [8.420240334320663, 0.4084656396493625], [8.420941713441229, 0.3567319151179839], [8.421390250749331, 0.3037872737761819], [8.421585011812653, 0.24974313053323663], [8.421525062198844, 0.19471090029842789], [8.42120946747559, 0.1388019979810365], [8.420637293210554, 0.08212783849034218], [8.419807604971401, 0.02479983673562515], [8.418719468325808, -0.03307059237383418], [8.417371948841433, -0.09137203392875394], [8.415764112085952, -0.14999307301985784], [8.413895023627033, -0.20882229473786357], [8.411763749032346, -0.26774828417349084], [8.409369353869558, -0.32665962641745994], [8.406710903706337, -0.38544490656049035], [8.403787464110355, -0.4439927096933021], [8.400598100649276, -0.5021916209066147], [8.397141878890773, -0.5599302252911483], [8.393417864402515, -0.6170971079376223], [8.389425122752167, -0.673580853936755], [8.385162719507402, -0.72927004837927], [8.380629720235886, -0.7840532763558847], [8.375825190505289, -0.83781912295732], [8.37074819588328, -0.8904561732742946], [8.36539780193753, -0.9418530123975292], [8.3597730742357, -0.991898225417743], [8.353873078345469, -1.040480397425656], [8.347696879834501, -1.0874881135119878], [8.341243544270464, -1.1328099587674587], [8.334512137221028, -1.176334518282787], [8.32750172425386, -1.217950377148695], [8.320211370936633, -1.2575461204559015], [8.312640142837013, -1.2950103332951262], [8.304787105522669, -1.330231600757089], [8.296306056814878, -1.3636463712481566], [8.284217616705455, -1.399900074199447], [8.268093448479835, -1.439647072956359], [8.24825461449327, -1.4823580458754901], [8.225022177101009, -1.5275036713134347], [8.198717198658315, -1.5745546276267903], [8.169660741520428, -1.6229815931721494], [8.138173868042607, -1.6722552463061124], [8.104577640580104, -1.7218462653852735], [8.069193121488173, -1.771225328766229], [8.03234137312207, -1.8198631148055746], [7.994343457837042, -1.8672303018599057], [7.955520437988343, -1.9127975682858196], [7.916193375931229, -1.9560355924399109], [7.8766833340209494, -1.9964150526787763], [7.837311374612758, -2.0334066273590117], [7.798398560061912, -2.066480994837212], [7.760265952723657, -2.0951088334699755], [7.723234614953251, -2.118760821613897], [7.687625609105942, -2.136907637625572], [7.653759997536988, -2.1490199598615973], [7.619165263499385, -2.157590962198846], [7.580023588387412, -2.166897796670356], [7.536861857349363, -2.1767416885885256], [7.490254447646883, -2.1868736962016193], [7.440775736541624, -2.1970448777579024], [7.389000101295235, -2.20700629150564], [7.335501919169371, -2.2165089956930992], [7.280855567425678, -2.225304048568545], [7.225635423325809, -2.2331425083802423], [7.1704158641314155, -2.2397754333764572], [7.115771267104148, -2.244953881805455], [7.0622760095056565, -2.248428911915502], [7.010504468597592, -2.2499515819548623], [6.960225453744448, -2.2499999999999996], [6.90999793078357, -2.25], [6.859770407822695, -2.2500000000000004], [6.809542884861816, -2.25], [6.759315361900938, -2.25], [6.709087838940061, -2.25], [6.658860315979184, -2.25], [6.608632793018305, -2.2499999999999996], [6.558405270057428, -2.25], [6.50817774709655, -2.25], [6.457950224135672, -2.25], [6.407722701174794, -2.25], [6.357495178213917, -2.25], [6.307267655253042, -2.25], [6.257040132292163, -2.25], [6.206812609331285, -2.25], [6.1565850863704075, -2.25], [6.106357563409531, -2.25], [6.056130040448652, -2.25], [6.005902517487774, -2.25], [5.9556749945268965, -2.2500000000000004], [5.90544747156602, -2.2500000000000004], [5.855219948605141, -2.2499999999999996], [5.804992425644265, -2.25], [5.754764902683388, -2.2499999999999996], [5.704537379722508, -2.2499999999999996], [5.654309856761633, -2.2500000000000004], [5.604082333800754, -2.2499999999999996], [5.553854810839876, -2.25], [5.503627287879001, -2.25], [5.453399764918124, -2.25], [5.403172241957247, -2.25], [5.352944718996368, -2.25], [5.30271719603549, -2.25], [5.252489673074614, -2.25], [5.202262150113736, -2.25], [5.152034627152858, -2.25], [5.10180710419198, -2.25], [5.051579581231103, -2.25], [5.001352058270225, -2.25], [4.951124535309347, -2.2500000000000004], [4.900897012348469, -2.25], [4.850669489387592, -2.25], [4.800441966426713, -2.2499999999999996], [4.750214443465836, -2.25], [4.6999869205049585, -2.25], [4.649759397544081, -2.2499999999999996], [4.599531874583204, -2.2499999999999996], [4.549304351622329, -2.2500000000000004], [4.499076828661451, -2.25], [4.448849305700573, -2.25], [4.398621782739696, -2.25], [4.348394259778818, -2.25], [4.29816673681794, -2.25], [4.247939213857062, -2.25], [4.197711690896185, -2.25], [4.147484167935307, -2.25], [4.097256644974429, -2.25], [4.0470291220135515, -2.25], [3.9968015990526737, -2.25], [3.9465740760917956, -2.25], [3.8963465531309183, -2.2500000000000004], [3.8461190301700405, -2.2499999999999996], [3.795891507209163, -2.2499999999999996], [3.7456639842482846, -2.25], [3.695436461287407, -2.25], [3.6452089383265296, -2.2499999999999996], [3.594981415365652, -2.25], [3.5447538924047737, -2.2499999999999996], [3.4945263694439, -2.25], [3.444298846483022, -2.25], [3.394071323522145, -2.25], [3.3438438005612663, -2.25], [3.293616277600389, -2.25], [3.2433887546395113, -2.25], [3.193161231678633, -2.25], [3.142933708717756, -2.25], [3.092706185756878, -2.25], [3.0424786627960003, -2.25], [2.9922429685184553, -2.2500045556876445], [2.9415901801216524, -2.2502159674923243], [2.8903698810611504, -2.2506162248347508], [2.838690092016654, -2.251029445260692], [2.786658833667865, -2.251279746315917], [2.734384126694489, -2.2511912455461944], [2.681973991776226, -2.250588060497291], [2.6295364495927807, -2.249294308714976], [2.577179520823856, -2.2471341077450178], [2.5250112261491546, -2.243931575133183], [2.4731395862483834, -2.2395108284252423], [2.4216726218012377, -2.2336959851669613], [2.370718353487425, -2.2263111629041106], [2.3203848019866475, -2.2171804791824568], [2.270779987978609, -2.2061280515477684], [2.2220119321430123, -2.1929779975458135], [2.1741886551595604, -2.1775544347223605], [2.127418177707956, -2.1596814806231786], [2.0818085204679027, -2.1391832527940338], [2.037467704119104, -2.1158838687806965], [1.9945037493412614, -2.0896074461289333], [1.9530246768140793, -2.0601781023845134], [1.9137563393806027, -2.0275429906689477], [1.8785777576765297, -1.992076689625267], [1.847400759311951, -1.953978448333191], [1.8199918412880385, -1.913425860751109], [1.7961175006059644, -1.8705965208374125], [1.7755442342669023, -1.825668022550492], [1.7580385392720257, -1.77881795984874], [1.7433669126225073, -1.730223926690546], [1.7312958513195194, -1.6800635170343003], [1.721591852364236, -1.6285143248383993], [1.714021412757829, -1.5757539440612252], [1.7083510295014717, -1.521959968661173], [1.7043471995963373, -1.4673099925966335], [1.7017764200435983, -1.4119816098259974], [1.7004051878444284, -1.356152414307656], [1.7, -1.3]]


def reward_function(params):
    # Read input parameters
    is_reversed = params['is_reversed']
    # all_wheels_on_track = params['all_wheels_on_track']
    # track_width = params['track_width']
    # distance_from_center = params['distance_from_center']
    # speed = params['speed']
    heading = params['heading']
    x = params['x']
    y = params['y']
    progress = params['progress']
    steps = params['steps']

    heading = wrap_360(heading)

    position = [x, y]

    # Give a very low reward by default
    reward = 1e-3

    # max_speed = 6
    best_position, slope = get_best_position(track_waypoints, [x, y])
    best_headings = [wrap_360(math.degrees(direction)) for direction in convert_slope(slope)]

    best_position_diff = get_distance(position, best_position)
    best_heading_diff = min([abs(heading - best_heading) for best_heading in best_headings])

    # Give a high reward if no wheels go off the track and
    # the agent is somewhere in between the track borders
    # if not is_reversed and all_wheels_on_track and (0.5 * track_width - distance_from_center) >= 0.05:
    if not is_reversed:
        reward = 1.0

    if steps:
        # speed_reward = (1 + (speed / max_speed)) ** 2
        position_reward = (1 + (1 - math.tanh(best_position_diff))) ** 2
        heading_reward = (1 + (1 - best_heading_diff / 360)) ** 2
        # reward *= (position_reward * heading_reward + speed_reward) ** 2
        reward *= (position_reward * heading_reward) ** 2
        reward *= (progress / steps) ** 3

    # Always return a float value
    return float(reward)
