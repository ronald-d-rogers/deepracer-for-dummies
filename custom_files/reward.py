import math


def wrap_360(angle):
    angle = angle % 360
    angle = (angle + 360) % 360

    return angle


def convert_slope(m):
    radians = math.atan2(m[1], m[0])
    dir1 = radians
    dir2 = (radians + math.pi) % (2 * math.pi)

    return [dir1, dir2]


def get_distance(p1, p2):
    return math.sqrt((p1[0] - p2[0]) ** 2 + (p1[1] - p2[1]) ** 2)


def get_nearest_point(waypoints, point):
    min_i = None
    min_distance = math.inf

    for i, waypoint in enumerate(waypoints):
        distance = get_distance(waypoint, point)
        if distance < min_distance:
            min_i = i
            min_distance = distance

    return min_i


def get_best_position(waypoints, point):
    i1 = get_nearest_point(waypoints, point)
    p1 = waypoints[i1]

    i2 = i1 + 1
    if i2 > len(waypoints) - 1:
        i2 = 0

    p2 = waypoints[i2]
    m = [p2[0] - p1[0], p2[1] - p1[1]]

    return p1, m


# Chosen optimal waypoints for the track

# re:Invent
# track_waypoints = [[1.0, 4.0], [0.9759276724718025, 3.9724393894551167], [0.9538894801694467, 3.940202588846274], [0.9338208672485439, 3.903624403444434], [0.915657277864707, 3.8630396385205654], [0.899334156173548, 3.8187830993456315], [0.8847869463306796, 3.7711895911905997], [0.8719510924917133, 3.7205939193264324], [0.8607620388122621, 3.667330889024098], [0.8511552294479381, 3.6117353055545616], [0.8430661085543528, 3.554141974188785], [0.8364301202871194, 3.494885700197739], [0.8311827088018501, 3.434301288852387], [0.8272593182541564, 3.3727235454236917], [0.8245953927996511, 3.3104872751826213], [0.8231263765939467, 3.2479272834001414], [0.822787713792655, 3.185378375347217], [0.8235148485513883, 3.1231753562948126], [0.8252432250257592, 3.0616530315138943], [0.8279082873713796, 3.0011462062754273], [0.8314454797438621, 2.9419896858503782], [0.8357902462988183, 2.8845182755097114], [0.8408780311918612, 2.829066780524392], [0.8466442785786027, 2.7759700061653856], [0.8530244326146552, 2.7255627577036585], [0.8599539374556308, 2.6781798404101753], [0.8673682372571418, 2.6341560595559015], [0.8752027761748006, 2.593826220411803], [0.8833929983642195, 2.557525128248845], [0.8918743479810104, 2.5255875883379924], [0.9005843143216649, 2.49832829156312], [0.9099877822202295, 2.470914893850284], [0.9204505702811524, 2.4396298607815052], [0.9319357128431216, 2.404747814225731], [0.9444062442448249, 2.3665433760519035], [0.95782519882495, 2.325291168128967], [0.9721556109221854, 2.2812658123258664], [0.9873605148752184, 2.2347419305115443], [1.0034029450227366, 2.1859941445549453], [1.0202459357034288, 2.1352970763250125], [1.0378525212559822, 2.0829253476906895], [1.0561857360190843, 2.029153580520921], [1.0752086143314241, 1.9742563966846518], [1.0948841905316884, 1.9185084180508227], [1.1151754989585654, 1.86218426648838], [1.1360455739507431, 1.8055585638662666], [1.1574574498469097, 1.748905932053428], [1.1793741609857527, 1.692500992918805], [1.2017587417059594, 1.6366183683313444], [1.2245742263462183, 1.5815326801599885], [1.2477836492452177, 1.5275185502736806], [1.2713500447416446, 1.4748506005413664], [1.295236447174187, 1.423803452831988], [1.3194058908815334, 1.3746517290144904], [1.343821410202371, 1.3276700509578165], [1.368446039475388, 1.2831330405309114], [1.393242813039272, 1.2413153196027178], [1.4181747652327115, 1.2024915100421796], [1.4432049303943932, 1.1669362337182414], [1.468296342863006, 1.1349241124998461], [1.4934120369772375, 1.1067297682559387], [1.5191396721679713, 1.0818433943965398], [1.5470184960056226, 1.0583843409684182], [1.5770592785145707, 1.0362219551183964], [1.6091934349760624, 1.0153212341370055], [1.6433523806713473, 0.9956471753147762], [1.6794675308816738, 0.9771647759422386], [1.7174703008882906, 0.959839033309924], [1.7572921059724467, 0.9436349447083627], [1.7988643614153899, 0.9285175074280857], [1.8421184824983692, 0.9144517187596232], [1.8869858845026324, 0.9014025759935059], [1.9333979827094299, 0.8893350764202649], [1.9812861924000085, 0.8782142173304305], [2.0305819288556175, 0.8680049960145334], [2.081216607357505, 0.858672409763104], [2.1331216431869207, 0.8501814558666736], [2.186228451625113, 0.8424971316157723], [2.2404684479533294, 0.8355844343009311], [2.29577304745282, 0.8294083612126804], [2.352073665404832, 0.823933909641551], [2.409301717090614, 0.8191260768780737], [2.467388617791416, 0.8149498602127787], [2.526265782788485, 0.8113702569361969], [2.5858646273630708, 0.8083522643388592], [2.646116566796422, 0.805860879711296], [2.706953016369786, 0.8038611003440379], [2.7683053913644127, 0.8023179235276159], [2.8301051070615495, 0.8011963465525602], [2.8922835787424463, 0.8004613667094016], [2.9547722216883514, 0.800077981288671], [3.017349688979692, 0.8], [3.077311973194231, 0.8], [3.133976827682789, 0.8], [3.1877242657404787, 0.8000000000000002], [3.2389343006624123, 0.8000000000000002], [3.2879869457437034, 0.8], [3.335262214279464, 0.8000000000000002], [3.381140119564809, 0.7999999999999999], [3.4260006748948517, 0.8000000000000002], [3.470223893564703, 0.8000000000000002], [3.5141897888694764, 0.8], [3.5582783741042867, 0.8], [3.6028696625642462, 0.8000000000000002], [3.6483436675444674, 0.8], [3.6950804023400625, 0.8], [3.7434598802461467, 0.8], [3.793862114557832, 0.8], [3.8466671185702324, 0.8000000000000002], [3.9022549055784594, 0.8], [3.9610054888776265, 0.8], [4.0229142965343945, 0.8], [4.084091116625683, 0.8], [4.143506134807588, 0.8], [4.201254354403883, 0.8], [4.257430778738348, 0.8000000000000002], [4.312130411134762, 0.8], [4.365448254916904, 0.8000000000000002], [4.417479313408549, 0.8000000000000002], [4.468318589933478, 0.8], [4.518061087815468, 0.8000000000000002], [4.566801810378299, 0.8000000000000002], [4.614635760945747, 0.7999999999999999], [4.661657942841592, 0.8000000000000002], [4.707963359389612, 0.8000000000000002], [4.753647013913583, 0.8], [4.798803909737288, 0.8], [4.843529050184499, 0.8], [4.8879174385790005, 0.8], [4.932064078244567, 0.8000000000000002], [4.976063972504978, 0.8000000000000002], [5.020012124684012, 0.8000000000000002], [5.064003538105445, 0.8], [5.108133216093059, 0.8], [5.152496161970627, 0.8], [5.197187379061934, 0.8], [5.242301870690754, 0.8], [5.287934640180865, 0.8000000000000002], [5.334180690856046, 0.8000000000000002], [5.381135026040077, 0.8], [5.428892649056735, 0.8], [5.477548563229798, 0.8], [5.527197771883044, 0.8], [5.577935278340251, 0.8000000000000002], [5.6298560859252, 0.8], [5.683055197961665, 0.8], [5.737627617773429, 0.8], [5.793668348684264, 0.8], [5.851272394017955, 0.8], [5.910534757098277, 0.8], [5.971550441249008, 0.8], [6.034012012433637, 0.8004144511537141], [6.095902232784513, 0.8033185255252248], [6.156849394972871, 0.80894951863862], [6.216758645516, 0.8172508594245665], [6.275535130931193, 0.8281659768137308], [6.333083997735751, 0.8416382997367806], [6.389310392446965, 0.8576112571243821], [6.444119461582126, 0.8760282779072023], [6.497416351658532, 0.8968327910159081], [6.549106209193472, 0.919968225381166], [6.5990941807042445, 0.9453780099336423], [6.647285412708146, 0.9730055736040059], [6.693585051722463, 1.0027943453229209], [6.737898244264497, 1.0346877540210566], [6.780130136851537, 1.068629228629079], [6.820185876000878, 1.1045621980776534], [6.857970608229816, 1.142430091297449], [6.893389480055642, 1.18217633721913], [6.926347637995654, 1.2237443647733666], [6.956750228567143, 1.2670776028908235], [6.984502398287405, 1.3121194805021665], [7.009509293673734, 1.3588134265380651], [7.03167606124342, 1.4071028699291834], [7.050907847513763, 1.456931239606191], [7.067109799002052, 1.5082419644997536], [7.080187062225586, 1.5609784735405356], [7.090044783701654, 1.6150841956592084], [7.096588109947554, 1.670502559786434], [7.099722187480578, 1.727176994852884], [7.099429541087556, 1.7844488796804607], [7.096006379025352, 1.839860416043187], [7.089565476277823, 1.8931976869596385], [7.080190821081375, 1.9445100454520536], [7.0679664016724155, 1.9938468445426705], [7.05297620628735, 2.041257437253735], [7.035304223162584, 2.0867911766074836], [7.015034440534523, 2.1304974156261585], [6.992250846639572, 2.172425507332001], [6.967037429714143, 2.21262480474725], [6.939478177994636, 2.251144660894148], [6.909657079717458, 2.2880344287949335], [6.8776581231190175, 2.323343461471851], [6.84356529643572, 2.357121111947137], [6.80746258790397, 2.389416733243033], [6.769433985760175, 2.4202796783817813], [6.729563478240743, 2.4497593003856215], [6.687935053582076, 2.4779049522767953], [6.64463270002058, 2.5047659870775414], [6.599740405792668, 2.5303917578101016], [6.553342159134738, 2.554831617496718], [6.5055219482832, 2.578134919159627], [6.456363761474459, 2.6003510158210736], [6.405951586944922, 2.621529260503298], [6.354369412930997, 2.6417190062285374], [6.301701227669083, 2.6609696060190355], [6.2480310193955955, 2.6793304128970328], [6.193442776346936, 2.6968507798847683], [6.138020486759508, 2.7135800600044844], [6.081848138869723, 2.7295676062784207], [6.025009720913984, 2.744862771728818], [5.967589221128695, 2.759514909377918], [5.909670627750269, 2.7735733722479594], [5.851337929015104, 2.7870875133611848], [5.792675113159612, 2.8001066857398333], [5.733766168420197, 2.8126802424061466], [5.6746950830332645, 2.824857536382365], [5.615545845235223, 2.8366879206907285], [5.556402443262475, 2.848220748353479], [5.497348865351431, 2.8595053723928565], [5.438469099738493, 2.8705911458311015], [5.379847134660068, 2.881527421690455], [5.321566958352564, 2.8923635529931575], [5.2637125590523866, 2.903148892761449], [5.206367924995941, 2.9139327940175717], [5.149617044419633, 2.924764609783765], [5.093543905559869, 2.93569369308227], [5.038232496653057, 2.946769396935327], [4.983766805935601, 2.9580410743651764], [4.930230821643908, 2.96955807839406], [4.877708532014385, 2.981369762044218], [4.826283925283436, 2.99352547833789], [4.775981158157867, 3.006254475324623], [4.726456848505933, 3.0207283961286278], [4.677625572115392, 3.0370803790831737], [4.629467497141737, 3.0552262537704893], [4.58196279174045, 3.075081849772809], [4.535091624067028, 3.0965629966723602], [4.488834162276952, 3.1195855240513732], [4.4431705745257135, 3.1440652614920794], [4.398081028968803, 3.169918038576707], [4.35354569376171, 3.197059684887491], [4.3095447370599205, 3.2254060300066567], [4.266058327018923, 3.2548729035164365], [4.223066631794209, 3.285376134999061], [4.180549819541267, 3.3168315540367597], [4.138488058415586, 3.349154990211765], [4.096861516572651, 3.3822622731063032], [4.055650362167957, 3.4160692323026076], [4.014834763356988, 3.4504916973829087], [3.974394888295236, 3.485445497929434], [3.9343109051381884, 3.520846463524419], [3.894562982041332, 3.5566104237500884], [3.855131287160161, 3.592653208188675], [3.8159959886501587, 3.62889064642241], [3.777137254666818, 3.665238568033522], [3.738535253365625, 3.7016128026042434], [3.7001701529020696, 3.7379291797168017], [3.662022121431642, 3.774103528953429], [3.624071327109829, 3.8100516798963557], [3.586297938092121, 3.8456894621278113], [3.548682122534005, 3.880932705230027], [3.511204048590971, 3.9156972387852327], [3.4738438844185087, 3.949898892375658], [3.4365817981721056, 3.983453495583535], [3.3993979580072518, 4.016276877991091], [3.3622725320794347, 4.04828486918056], [3.3251856885441438, 4.07939329873417], [3.2881175955568693, 4.1095179962341515], [3.251048421273098, 4.1385747912627355], [3.2139583338483186, 4.166479513402153], [3.176827501438023, 4.193147992234631], [3.139636092197697, 4.218496057342404], [3.102364274282831, 4.2424395383077], [3.0649922158489122, 4.2648942647127495], [3.027500085051431, 4.285776066139784], [2.9898093685026277, 4.305022991539365], [2.9507982879357093, 4.322997832163127], [2.9101119256773984, 4.339844177716971], [2.8678390826966655, 4.355547474510421], [2.8240685599624853, 4.37009316885299], [2.7788891584438336, 4.383466707054199], [2.7323896791096813, 4.395653535423566], [2.6846589229290054, 4.406639100270612], [2.635785690870777, 4.416408847904852], [2.58585878390397, 4.424948224635807], [2.5349670029975626, 4.432242676772997], [2.483199149120523, 4.438277650625937], [2.430644023241828, 4.44303859250415], [2.377390426330452, 4.446510948717151], [2.3235271593553666, 4.4486801655744594], [2.269143023285548, 4.449531689385594], [2.2143268190899676, 4.449050966460076], [2.159167347737601, 4.447223443107425], [2.1037534101974242, 4.444034565637154], [2.0481738074384053, 4.4394697803587855], [1.992517340429524, 4.433514533581837], [1.9368728101397494, 4.426154271615827], [1.8813290175380581, 4.417374440770276], [1.8259747635934254, 4.407160487354702], [1.770898849274821, 4.395497857678622], [1.7161900755512232, 4.382371998051558], [1.6619372433916018, 4.367768354783025], [1.6082291537649325, 4.351672374182543], [1.555154607640191, 4.334069502559634], [1.5028024059863476, 4.314945186223813], [1.45126134977238, 4.294284871484599], [1.400620239967258, 4.272074004651511], [1.3509678775399578, 4.24829803203407], [1.3023930634594545, 4.2229423999417905], [1.2549845986947186, 4.195992554684194], [1.208831284214726, 4.167433942570799], [1.1640219209884521, 4.1372520099111245], [1.1206453099848672, 4.105432203014688], [1.0787902521729487, 4.07195996819101], [1.0385455485216675, 4.036820751749607], [1.0, 4.0]]

# AWS Track
# track_waypoints = [[0.65, 2.7], [0.6547644898026962, 2.6679268999636667], [0.660087893475242, 2.632199906180963], [0.6660764566087195, 2.593148516845369], [0.6728364247942101, 2.551102230150361], [0.6804740436227958, 2.5063905442894217], [0.6890955586855584, 2.459342957456027], [0.698807215573579, 2.4102889678436563], [0.7097152598779399, 2.3595580736457884], [0.7219259371897229, 2.3074797730559036], [0.7355454931000092, 2.2543835642674774], [0.7506801731998807, 2.200598945473992], [0.7674362230804195, 2.1464554148689245], [0.7859198883327067, 2.0922824706457543], [0.8062374145478245, 2.0384096109979595], [0.8284950473168542, 1.9851663341190193], [0.852799032230878, 1.9328821382024124], [0.8792556148809774, 1.8818865214416178], [0.9079710408582339, 1.8325089820301141], [0.9390515557537293, 1.7850790181613803], [0.9726034051585455, 1.7399261280288951], [1.008732834663764, 1.6973798098261372], [1.0475460898604672, 1.6577695617465853], [1.089149416339736, 1.6214248819837187], [1.133649059692652, 1.5886752687310155], [1.1811512655102976, 1.5598502201819553], [1.231076628868601, 1.5346217994934515], [1.2808723893629308, 1.510642957745042], [1.330305260456223, 1.4876344231387693], [1.3793969902135372, 1.4655544880461298], [1.428169326699933, 1.4443614448386206], [1.4766440179804687, 1.4240135858877383], [1.5248428121202036, 1.4044692035649802], [1.572787457184197, 1.3856865902418427], [1.6204997012375082, 1.3676240382898235], [1.668001292345196, 1.3502398400804185], [1.7153139785723188, 1.3334922879851252], [1.7624595079839376, 1.3173396743754413], [1.8094596286451095, 1.301740291622862], [1.8563360886208942, 1.2866524320988852], [1.9031106359763517, 1.272034388175008], [1.9498050187765406, 1.2578444522227274], [1.9964409850865197, 1.24404091661354], [2.043040282971348, 1.2305820737189421], [2.089624660496085, 1.2174262159104314], [2.13621586572579, 1.2045316355595046], [2.182835646725522, 1.1918566250376588], [2.229505751560339, 1.1793594767163906], [2.2762479282953016, 1.1669984829671973], [2.3230839249954682, 1.1547319361615755], [2.370035489725898, 1.1425181286710224], [2.4171243705516505, 1.1303153528670347], [2.4643723155377844, 1.1180819011211092], [2.5118010727493583, 1.105776065804743], [2.559432390251432, 1.0933561392894329], [2.607288016109065, 1.0807804139466761], [2.6553896983873155, 1.0680071821479693], [2.7037591851512435, 1.0549947362648093], [2.7524182244659063, 1.0417013686686936], [2.8013885643963654, 1.0280853717311182], [2.8506919530076793, 1.0141050378235807], [2.9003501383649053, 0.999718659317578], [2.9503848469371623, 0.9848845229008387], [3.0004438642852005, 0.9694799293888582], [3.0501840777852003, 0.9534532385660816], [3.09962407455227, 0.9368649091435488], [3.148782441701518, 0.9197753998322988], [3.1976777663480522, 0.9022451693433711], [3.24632863560698, 0.8843346763878052], [3.2947536365934087, 0.8661043796766399], [3.3429713564224475, 0.8476147379209146], [3.3910003822092016, 0.8289262098316689], [3.438859301068782, 0.810099254119942], [3.486566700116296, 0.7911943294967734], [3.5341411664668496, 0.772271894673202], [3.5816012872355536, 0.7533924083602674], [3.628965649537513, 0.734616329269009], [3.6762528404878365, 0.7160041161104659], [3.723481447201635, 0.6976162275956773], [3.7706700567940112, 0.6795131224356831], [3.8178372563800766, 0.661755259341522], [3.865001633074939, 0.6444030970242337], [3.912181773993704, 0.6275170941948575], [3.959396266251482, 0.6111577095644323], [4.006663696963379, 0.5953854018439979], [4.054002653244505, 0.5802606297445934], [4.101431722209966, 0.565843851977258], [4.14896949097487, 0.5521955272530312], [4.196634546654326, 0.5393761142829523], [4.244445476363441, 0.5274460717780605], [4.292420867217322, 0.5164658584493954], [4.34057930633108, 0.5064959330079959], [4.38893938081982, 0.4975967541649016], [4.43751967779865, 0.489828780631152], [4.48633878438268, 0.4832524711177859], [4.535415287687016, 0.47792828433584295], [4.5847677748267675, 0.4739166789963624], [4.63441483291704, 0.47127811381038354], [4.684375049072942, 0.47007304748894585], [4.734411212546735, 0.4703427912384255], [4.783771559434398, 0.47205180054969825], [4.83242338148067, 0.47517732191211687], [4.880386303654703, 0.4796992152234553], [4.927679950925642, 0.4855973403814868], [4.974323948262639, 0.4928515572839848], [5.020337920634847, 0.501441725828723], [5.065741493011413, 0.5113477059134749], [5.1105542903614865, 0.5225493574360139], [5.154795937654219, 0.5350265402941137], [5.198486059858761, 0.5487591143855475], [5.241644281944263, 0.5637269396080894], [5.284290228879869, 0.579909875859512], [5.326443525634737, 0.59728778303759], [5.368123797178012, 0.615840521040096], [5.409350668478847, 0.6355479497648036], [5.450143764506388, 0.6563899291094869], [5.49052271022979, 0.6783463189719187], [5.5305071306182, 0.7013969792498731], [5.5701166506407676, 0.7255217698411233], [5.609370895266642, 0.7507005506434424], [5.648289489464979, 0.7769131815546053], [5.686892058204922, 0.8041395224723842], [5.725198226455621, 0.8323594332945526], [5.763227619186231, 0.8615527739188851], [5.8009998613659, 0.8916994042431546], [5.838534577963774, 0.922779184165134], [5.875851393949009, 0.9547719735825978], [5.91296993429075, 0.9876576323933188], [5.949909823958153, 1.0214160204950713], [5.986690687920364, 1.0560269977856285], [6.023332151146528, 1.091470424162763], [6.059853838605806, 1.1277261595242498], [6.096275375267338, 1.1647740637678612], [6.132616386100281, 1.2025939967913717], [6.16889649607378, 1.2411658184925547], [6.205135330156988, 1.2804693887691823], [6.241352513319055, 1.32048456751903], [6.27756767052913, 1.3611912146398701], [6.313800426756361, 1.4025691900294763], [6.350070406969902, 1.4445983535856222], [6.386397236138899, 1.487258565206082], [6.422800539232505, 1.5305296847886276], [6.45929994121987, 1.5743915722310342], [6.4959150670701415, 1.618824087431074], [6.532665541752472, 1.6638070902865216], [6.569570990236009, 1.7093204406951505], [6.606651037489906, 1.7553439985547326], [6.643925308483309, 1.8018576237630435], [6.681413428185371, 1.8488411762178554], [6.719135021565241, 1.8962745158169425], [6.757109713592068, 1.9441375024580778], [6.795357129235002, 1.9924099960390351], [6.833896893463195, 2.041071856457588], [6.872748631245797, 2.09010294361151], [6.911931967551955, 2.1394831173985738], [6.951466527350821, 2.1891922377165547], [6.991371935611545, 2.239210164463225], [7.031305337375271, 2.289674344718863], [7.070489095479172, 2.340896263286473], [7.108895838419715, 2.3928482164483555], [7.146525216185115, 2.4454905357088035], [7.183376878763588, 2.498783552572113], [7.219450476143355, 2.5526875985425743], [7.254745658312626, 2.607163005124481], [7.289262075259627, 2.6621701038221324], [7.322999376972565, 2.717669226139816], [7.355957213439661, 2.773620703581829], [7.3881352346491305, 2.829984867652463], [7.419533090589191, 2.8867220498560107], [7.450150431248058, 2.943792581696769], [7.4799869066139495, 3.001156794679032], [7.509042166675079, 3.058775020307089], [7.537315861419668, 3.1166075900852377], [7.5648076408359275, 3.1746148355177697], [7.5915171549120775, 3.2327570881089773], [7.617444053636334, 3.290994679363158], [7.642587986996912, 3.349287940784603], [7.6669486049820295, 3.4075972038776072], [7.690525557579906, 3.4658828001464648], [7.7133184947787505, 3.5241050610954643], [7.735327066566783, 3.582224318228905], [7.756550922932225, 3.6402009030510802], [7.776989713863286, 3.697995147066281], [7.796643089348186, 3.755567381778804], [7.815510699375142, 3.8128779386929406], [7.833592193932369, 3.8698871493129823], [7.850887223008082, 3.9265553451432273], [7.8673954365905026, 3.9828428576879693], [7.883116484667842, 4.038710018451498], [7.8980500172283215, 4.094117158938111], [7.912195684260153, 4.149024610652098], [7.925553135751555, 4.203392705097756], [7.938122021690744, 4.257181773779379], [7.949901992065939, 4.310352148201258], [7.960892696865353, 4.362864159867688], [7.971093786077203, 4.414678140282962], [7.980504909689705, 4.4657544209513755], [7.9891257176910795, 4.5160533333772195], [7.996955860069539, 4.565535209064791], [8.003994986813304, 4.61416037951838], [8.010242747910585, 4.6618891762422825], [8.015698793349603, 4.708681930740791], [8.020362773118574, 4.754498974518202], [8.024234337205716, 4.7993006390788056], [8.02731313559924, 4.843047255926897], [8.029598818287367, 4.885699156566771], [8.031091035258314, 4.927216672502716], [8.031789436500294, 4.967560135239033], [8.031693672001527, 5.006689876280012], [8.030803391750226, 5.0445662271299465], [8.029118245734614, 5.081149519293131], [8.0266378839429, 5.116400084273859], [8.023361956363306, 5.150278253576423], [8.019290112984045, 5.1827443587051185], [8.014422003793335, 5.213758731164239], [8.008757278779393, 5.243281702458077], [8.002295587930433, 5.2712736040909265], [7.995036581234677, 5.297694767567081], [7.986979908680336, 5.322505524390834], [7.978125220255627, 5.345666206066482], [7.9684721659487705, 5.367137144098315], [7.95802039574798, 5.386878669990629], [7.946720516195448, 5.404960740270885], [7.933686947423926, 5.423282979426236], [7.918570619430993, 5.442453276979845], [7.901344549553543, 5.462347095113765], [7.881981755128461, 5.482839896010047], [7.86045525349264, 5.50380714185074], [7.836738061982969, 5.525124294817902], [7.810803197936337, 5.546666817093578], [7.782623678689638, 5.568310170859826], [7.752172521579754, 5.589929818298692], [7.719422743943582, 5.611401221592232], [7.684347363118007, 5.632599842922494], [7.64691939643992, 5.653401144471536], [7.607111861246213, 5.673680588421404], [7.564897774873772, 5.693313636954151], [7.52025015465949, 5.71217575225183], [7.473142017940261, 5.730142396496493], [7.423546382052965, 5.747089031870191], [7.371436264334497, 5.7628911205549755], [7.316784682121746, 5.7774241247328995], [7.259564652751602, 5.790563506586014], [7.199749193560958, 5.802184728296369], [7.137311321886697, 5.81216325204602], [7.072224055065713, 5.820374540017016], [7.004460410434897, 5.82669405439141], [6.933993405331135, 5.830997257351253], [6.860796057091319, 5.833159611078598], [6.784841383052341, 5.833056577755495], [6.706102400551086, 5.830563619563998], [6.624552126924447, 5.825556198686156], [6.540163579509313, 5.817909777304024], [6.452909775642572, 5.807499817599652], [6.363253100721735, 5.794374715079609], [6.275488464006795, 5.779992806086065], [6.190568284116947, 5.764733877184396], [6.108422078525107, 5.748626015312867], [6.028979364704182, 5.731697307409742], [5.952169660127086, 5.713975840413283], [5.877922482266726, 5.6954897012617565], [5.806167348596012, 5.676266976893422], [5.736833776587854, 5.656335754246544], [5.669851283715168, 5.63572412025939], [5.605149387450861, 5.614460161870217], [5.542657605267842, 5.592571966017294], [5.48230545463902, 5.570087619638879], [5.424022453037309, 5.54703520967324], [5.367738117935619, 5.523442823058638], [5.313381966806857, 5.499338546733338], [5.260883517123939, 5.474750467635603], [5.210172286359771, 5.449706672703695], [5.161177791987265, 5.42423524887588], [5.113829551479332, 5.39836428309042], [5.068057082308879, 5.372121862285577], [5.023789901948822, 5.345536073399618], [4.980957527872066, 5.318635003370802], [4.939489477551525, 5.291446739137397], [4.899315268460109, 5.2639993676376635], [4.860364418070723, 5.236320975809862], [4.822566443856285, 5.208439650592266], [4.785850863289702, 5.180383478923128], [4.750147193843887, 5.152180547740718], [4.715384952991744, 5.123858943983297], [4.681493658206189, 5.095446754589127], [4.648402826960132, 5.066972066496476], [4.616041976726482, 5.038462966643604], [4.584340624978149, 5.009947541968774], [4.553228289188045, 4.981453879410252], [4.5226344868290775, 4.953010065906299], [4.49248873537416, 4.92464418839518], [4.462720552296203, 4.896384333815159], [4.433259455068114, 4.868258589104497], [4.404034961162805, 4.840295041201459], [4.374976588053187, 4.8125217770443065], [4.3460138532121695, 4.7849668835713075], [4.317076274112663, 4.757658447720722], [4.288093368227579, 4.730624556430813], [4.258994653029826, 4.703893296639845], [4.229709645992316, 4.677492755286082], [4.200167864587959, 4.651451019307786], [4.170298826289664, 4.625796175643222], [4.140032048570344, 4.600556311230653], [4.109297048902908, 4.575759513008341], [4.078023344760265, 4.551433867914552], [4.046140453615328, 4.527607462887547], [4.013577892941005, 4.504308384865591], [3.9802651802102096, 4.481564720786947], [3.946131832895849, 4.459404557589879], [3.9111073684708346, 4.437855982212649], [3.8751213044080766, 4.416947081593521], [3.838103158180486, 4.396705942670758], [3.799982447260973, 4.377160652382625], [3.760688689122449, 4.358339297667385], [3.720151401237823, 4.340269965463301], [3.6783001010800045, 4.322980742708635], [3.6350643061219055, 4.306499716341653], [3.590373533836436, 4.2908549733006165], [3.5441573016965084, 4.276074600523791], [3.496345127175027, 4.2621866849494365], [3.4468700282481377, 4.249218982600174], [3.3966808596893863, 4.237092299900527], [3.3465570546442907, 4.225704833403504], [3.296495401242945, 4.215020259078374], [3.246492687615433, 4.205002252894404], [3.1965457018918517, 4.195614490820867], [3.1466512322022835, 4.186820648827026], [3.096806066676818, 4.178584402882153], [3.047006993445548, 4.170869428955516], [2.997250800638557, 4.163639403016384], [2.9475342763859413, 4.156858001034024], [2.8978542088177854, 4.1504888989777085], [2.848207386064177, 4.144495772816702], [2.7985905962552104, 4.1388422985202755], [2.749000627520969, 4.133492152057697], [2.699434267991547, 4.128409009398234], [2.649888305797033, 4.123556546511159], [2.6003595290675094, 4.118898439365736], [2.5508447259330738, 4.114398363931236], [2.501340684523809, 4.110019996176928], [2.451844192969811, 4.10572701207208], [2.4023520394011606, 4.101483087585961], [2.3528610119479545, 4.09725189868784], [2.3033678987402793, 4.0929971213469845], [2.25386948790822, 4.088682431532664], [2.204362567581872, 4.084271505214147], [2.154843925891318, 4.079728018360702], [2.105310350966654, 4.075015646941599], [2.055758630937966, 4.070098066926104], [2.0061855539353393, 4.064938954283489], [1.9565879080888702, 4.0595019849830205], [1.9069624815286406, 4.053750834993966], [1.8573060623847468, 4.047649180285598], [1.8076154387872747, 4.041160696827182], [1.7578873988663093, 4.034249060587989], [1.7081187307519468, 4.026877947537285], [1.65830622257427, 4.01901103364434], [1.6084466624633742, 4.010611994878422], [1.5585368385493457, 4.001644507208803], [1.5085735389622694, 3.9920722466047467], [1.458553551832242, 3.9818588890355255], [1.4084736652893455, 3.9709681104704058], [1.358330667463676, 3.9593635868786574], [1.3081582593934453, 3.9469716969336646], [1.2588696946622784, 3.932853859752659], [1.210910058204542, 3.9166049453339777], [1.1643463789169721, 3.898210873988968], [1.1192456856963156, 3.877657566028979], [1.075675007439306, 3.8549309417653554], [1.0337013730426918, 3.8300169215094484], [0.9933918114032103, 3.802901425572607], [0.9548133514176, 3.773570374266175], [0.9180330219826067, 3.742009687901504], [0.8831178519949667, 3.7082052867899384], [0.8501348703514262, 3.672143091242833], [0.819151105948723, 3.6338090215715297], [0.7902335876835961, 3.5931889980873764], [0.7634493444527909, 3.5502689411017263], [0.7388654051530446, 3.50503477092592], [0.7165487986811012, 3.4574724078713137], [0.6965665539337003, 3.407567772249252], [0.6789856998075814, 3.355306784371078], [0.663873265199488, 3.300675364548148], [0.6512962790061592, 3.243659433091803], [0.6413217701243373, 3.184244910313398], [0.6340167674507626, 3.1224177165242772], [0.6294482998821759, 3.0581637720357846], [0.6276833963153184, 2.9914689971592767], [0.6287890856469313, 2.922319312206092], [0.6328323967737549, 2.850700637487589], [0.6398803585925307, 2.776598893315111], [0.65, 2.7]]

# Tokyo Training Track
track_waypoints = [[1.7, -1.3], [1.7004051878444286, -1.356152414307656], [1.701776420043598, -1.411981609825997], [1.7043471995963373, -1.4673099925966326], [1.7083510295014714, -1.5219599686611722], [1.714021412757829, -1.5757539440612247], [1.721591852364236, -1.628514324838398], [1.7312958513195202, -1.6800635170343032], [1.743366912622508, -1.7302239266905484], [1.7580385392720268, -1.7788179598487424], [1.7755442342669037, -1.825668022550495], [1.7961175006059655, -1.8705965208374145], [1.8199918412880394, -1.9134258607511108], [1.8474007593119526, -1.9539784483331926], [1.8785777576765317, -1.992076689625269], [1.9137563393806043, -2.0275429906689495], [1.9530246768140809, -2.0601781023845143], [1.9945037493412627, -2.0896074461289342], [2.0374677041191047, -2.1158838687806965], [2.0818085204679035, -2.139183252794034], [2.1274181777079573, -2.1596814806231786], [2.1741886551595617, -2.177554434722361], [2.2220119321430127, -2.1929779975458135], [2.2707799879786097, -2.206128051547768], [2.3203848019866484, -2.217180479182457], [2.3707183534874248, -2.22631116290411], [2.4216726218012377, -2.2336959851669618], [2.4731395862483834, -2.2395108284252423], [2.5250112261491577, -2.2439315751331836], [2.5771795208238597, -2.2471341077450178], [2.629536449592784, -2.249294308714976], [2.681973991776229, -2.250588060497291], [2.7343841266944917, -2.2511912455461944], [2.786658833667868, -2.2512797463159173], [2.8386900920166562, -2.2510294452606923], [2.8903698810611522, -2.2506162248347508], [2.9415901801216537, -2.250215967492324], [2.992242968518457, -2.2500045556876445], [3.042478662796002, -2.2499999999999996], [3.0927061857568794, -2.2499999999999996], [3.142933708717757, -2.25], [3.1931612316786344, -2.25], [3.243388754639512, -2.25], [3.29361627760039, -2.25], [3.343843800561267, -2.25], [3.3940713235221445, -2.25], [3.444298846483022, -2.25], [3.4945263694439, -2.25], [3.5447538924047772, -2.25], [3.594981415365655, -2.25], [3.6452089383265327, -2.25], [3.69543646128741, -2.25], [3.7456639842482877, -2.25], [3.7958915072091655, -2.25], [3.846119030170043, -2.25], [3.8963465531309205, -2.25], [3.946574076091798, -2.25], [3.9968015990526755, -2.25], [4.047029122013553, -2.2499999999999996], [4.09725664497443, -2.25], [4.147484167935308, -2.25], [4.197711690896186, -2.25], [4.247939213857063, -2.25], [4.298166736817941, -2.2500000000000004], [4.348394259778818, -2.2500000000000004], [4.398621782739696, -2.2500000000000004], [4.448849305700574, -2.25], [4.499076828661451, -2.25], [4.549304351622329, -2.25], [4.599531874583206, -2.25], [4.649759397544084, -2.25], [4.699986920504961, -2.25], [4.750214443465839, -2.25], [4.800441966426716, -2.25], [4.8506694893875935, -2.25], [4.900897012348472, -2.25], [4.951124535309349, -2.25], [5.001352058270227, -2.25], [5.0515795812311035, -2.25], [5.101807104191982, -2.25], [5.152034627152861, -2.2500000000000004], [5.202262150113737, -2.2499999999999996], [5.2524896730746145, -2.2500000000000004], [5.302717196035492, -2.25], [5.352944718996368, -2.25], [5.403172241957247, -2.249999999999999], [5.4533997649181245, -2.25], [5.503627287879001, -2.25], [5.55385481083988, -2.2499999999999996], [5.604082333800758, -2.25], [5.6543098567616354, -2.25], [5.704537379722513, -2.25], [5.754764902683389, -2.25], [5.804992425644268, -2.25], [5.855219948605145, -2.25], [5.905447471566022, -2.25], [5.9556749945269, -2.25], [6.005902517487777, -2.25], [6.056130040448656, -2.25], [6.106357563409533, -2.2500000000000004], [6.156585086370411, -2.25], [6.206812609331288, -2.25], [6.257040132292166, -2.25], [6.3072676552530424, -2.25], [6.357495178213921, -2.25], [6.407722701174798, -2.2500000000000004], [6.457950224135676, -2.25], [6.508177747096553, -2.25], [6.558405270057432, -2.25], [6.608632793018309, -2.25], [6.658860315979187, -2.25], [6.709087838940063, -2.25], [6.759315361900942, -2.25], [6.809542884861819, -2.25], [6.859770407822697, -2.25], [6.909997930783574, -2.25], [6.960225453744451, -2.25], [7.010504468597596, -2.2499515819548623], [7.062276009505659, -2.248428911915501], [7.1157712671041535, -2.2449538818054555], [7.17041586413142, -2.2397754333764572], [7.225635423325812, -2.2331425083802423], [7.280855567425679, -2.2253040485685442], [7.335501919169372, -2.216508995693099], [7.389000101295239, -2.2070062915056394], [7.440775736541626, -2.197044877757901], [7.490254447646885, -2.1868736962016184], [7.536861857349367, -2.1767416885885247], [7.580023588387418, -2.1668977966703555], [7.619165263499388, -2.157590962198845], [7.653759997536991, -2.149019959861596], [7.687625609105945, -2.1369076376255713], [7.7232346149532525, -2.118760821613896], [7.76026595272366, -2.095108833469974], [7.798398560061915, -2.0664809948372103], [7.837311374612763, -2.033406627359009], [7.876683334020951, -1.9964150526787732], [7.91619337593123, -1.9560355924399075], [7.955520437988345, -1.912797568285816], [7.994343457837043, -1.8672303018599024], [8.03234137312207, -1.8198631148055708], [8.069193121488178, -1.771225328766226], [8.104577640580107, -1.7218462653852713], [8.138173868042609, -1.67225524630611], [8.16966074152043, -1.6229815931721467], [8.198717198658315, -1.5745546276267859], [8.225022177101014, -1.5275036713134318], [8.248254614493272, -1.4823580458754875], [8.268093448479837, -1.4396470729563566], [8.284217616705458, -1.3999000741994445], [8.296306056814878, -1.3636463712481544], [8.30478710552267, -1.3302316007570871], [8.312640142837013, -1.2950103332951244], [8.320211370936631, -1.2575461204558995], [8.32750172425386, -1.2179503771486926], [8.33451213722103, -1.1763345182827847], [8.341243544270464, -1.1328099587674558], [8.3476968798345, -1.087488113511985], [8.35387307834547, -1.0404803974256527], [8.359773074235703, -0.9918982254177394], [8.365397801937528, -0.9418530123975254], [8.370748195883284, -0.8904561732742913], [8.375825190505289, -0.8378191229573162], [8.380629720235886, -0.7840532763558828], [8.385162719507402, -0.7292700483792678], [8.389425122752169, -0.6735808539367533], [8.393417864402513, -0.6170971079376181], [8.397141878890773, -0.5599302252911442], [8.400598100649278, -0.5021916209066106], [8.403787464110355, -0.44399270969329774], [8.406710903706339, -0.3854449065604864], [8.409369353869558, -0.3266596264174557], [8.411763749032348, -0.2677482841734868], [8.413895023627035, -0.2088222947378614], [8.415764112085952, -0.1499930730198556], [8.417371948841433, -0.09137203392875196], [8.418719468325806, -0.033070592373830254], [8.419807604971403, 0.024799836735629216], [8.420637293210554, 0.08212783849034619], [8.421209467475592, 0.13880199798104054], [8.421525062198846, 0.19471090029843194], [8.42158501181265, 0.24974313053324038], [8.421390250749333, 0.30378727377618575], [8.420941713441227, 0.35673191511798574], [8.420240334320663, 0.40846563964936417], [8.419287047819973, 0.45887703246103895], [8.418082788371485, 0.5078546786437299], [8.416628490407536, 0.5552871632881566], [8.41492508836045, 0.6010630714850392], [8.412973516662564, 0.6450709883250969], [8.410774709746207, 0.6871994988990505], [8.408329602043707, 0.7273371882976192], [8.405639127987401, 0.7653726416115214], [8.402704222009616, 0.8011944439314799], [8.399535302449268, 0.8347376946801632], [8.396683588170433, 0.8686752567918948], [8.39441639619859, 0.9045455966312593], [8.392659233028658, 0.9422584631161265], [8.391337605155554, 0.9817236051643675], [8.390377019074194, 1.022850771693853], [8.389702981279498, 1.065549711622454], [8.389240998266386, 1.1097301738680412], [8.38891657652977, 1.1553019073484825], [8.388655222564575, 1.2021746609816537], [8.388382442865716, 1.2502581836854232], [8.38802374392811, 1.2994622243776612], [8.387504632246674, 1.3496965319762393], [8.386750614316334, 1.4008708553990277], [8.385687196632, 1.4528949435638976], [8.38423988568859, 1.505678545388719], [8.382334187981025, 1.5591314097913633], [8.379895610004226, 1.6131632856897014], [8.376849658253107, 1.6676839220016013], [8.373121839222584, 1.7226030676449384], [8.36863765940758, 1.7778304715375808], [8.363322625303013, 1.8332758825974], [8.357102243403796, 1.8888490497422663], [8.349902020204853, 1.9444597218900501], [8.341647462201099, 2.0000176479586234], [8.332264075887451, 2.0554325768658552], [8.321677367758829, 2.1106142575296176], [8.309812844310152, 2.165472438867781], [8.296596012036336, 2.2199168697982143], [8.2819523774323, 2.273857299238791], [8.265807446992962, 2.327203476107382], [8.24808672721324, 2.379865149321856], [8.228715724588051, 2.4317520678000846], [8.207619945612317, 2.48277398045994], [8.183851687586452, 2.5317591864858024], [8.154692699132086, 2.5751887435613994], [8.120429912210447, 2.6130895283015136], [8.081597642546672, 2.6457882327031492], [8.0387302058659, 2.6736115487633114], [7.992361917893267, 2.696886168479008], [7.943027094353914, 2.715938783847242], [7.8912600509729804, 2.731096086865019], [7.837595103475602, 2.7426847695293457], [7.78256656758692, 2.7510315238372254], [7.726708759032071, 2.7564630417856644], [7.670555993536197, 2.7593060153716675], [7.614642586824432, 2.7598871365922406], [7.559502854621917, 2.758533097444389], [7.505671112653793, 2.755570589925118], [7.453681676645195, 2.7513263060314324], [7.403056683047378, 2.745445906356316], [7.351627709099135, 2.7363859787253495], [7.299692091462226, 2.7242115097664423], [7.247685257768241, 2.709079135495473], [7.19604263564877, 2.6911454919283164], [7.1451996527354105, 2.6705672150808515], [7.0955917366597445, 2.647500940968952], [7.04765431505337, 2.6221033056084964], [7.001822815547878, 2.594530945015363], [6.9585326657748565, 2.5649404952054256], [6.918219293365898, 2.533488592194562], [6.881318125952595, 2.5003318719986494], [6.848264591166537, 2.465626970633564], [6.8194941166393175, 2.4295305241151834], [6.795382861748934, 2.392173625842508], [6.774387205950271, 2.3529092338260225], [6.7555763708277885, 2.3114868134421824], [6.738837638646436, 2.2680296827783506], [6.724058291671158, 2.2226611599218877], [6.711125612166905, 2.1755045629601564], [6.699926882398627, 2.1266832099805195], [6.69034938463127, 2.0763204190703393], [6.682280401129781, 2.0245395083169777], [6.675607214159114, 1.9714637958077967], [6.6702171059842135, 1.9172165996301591], [6.665997358870027, 1.861921237871427], [6.6628352550815055, 1.8057010286189628], [6.660618076883597, 1.7486792899601302], [6.659233106541249, 1.6909793399822883], [6.6585676263194085, 1.6327244967728005], [6.658508918483027, 1.5740380784190298], [6.658944265297053, 1.5150434030083382], [6.65976094902643, 1.4558637886280872], [6.66084625193611, 1.39662255336564], [6.662087456291044, 1.3374430153083587], [6.663371844356177, 1.2784484925436057], [6.664586698396457, 1.2197623031587426], [6.665619300676836, 1.1615077652411343], [6.666356933462258, 1.1038081968781386], [6.666686879017673, 1.0467869161571202], [6.666496419608029, 0.9905672411654405], [6.665672837498278, 0.9352724899904626], [6.664103414953362, 0.8810259807195486], [6.661675434238235, 0.8279510314400605], [6.658276177617844, 0.7761709602393609], [6.653792927357136, 0.7258090852048119], [6.648112965721062, 0.6769887244237756], [6.641123574974567, 0.6298331959836158], [6.632712037382601, 0.5844658179716918], [6.622765635210112, 0.5410099084753675], [6.611171650722049, 0.4995887855820047], [6.597817366183362, 0.4603257673789663], [6.582590063858996, 0.42334417195361396], [6.565377026013903, 0.3887673173933104], [6.546065534913028, 0.35671852178541763], [6.524542872821321, 0.3273211032172979], [6.500696322003732, 0.3006983797763136], [6.474832329785176, 0.27595167524407754], [6.447401601735818, 0.2519751450521856], [6.418439881354172, 0.22875308934157418], [6.387982589340766, 0.20627062393625428], [6.356065146396121, 0.18451286466023661], [6.322722973220772, 0.163464927337532], [6.287991490515241, 0.14311192779215134], [6.2519061189800595, 0.1234389818481055], [6.214502279315749, 0.10443120532940527], [6.175815392222842, 0.08607371406006156], [6.135880878401864, 0.06835162386408578], [6.09473415855334, 0.0512500505654875], [6.0524106533778, 0.034754109988278215], [6.008945783575769, 0.018848917956468883], [5.9643749698477775, 0.0035195902940701736], [5.918733632894348, -0.011248757174906959], [5.872057193416012, -0.025471008626451706], [5.824381072113293, -0.03916204823655319], [5.775740689686721, -0.052336760181200676], [5.7261714668368215, -0.06501002863638314], [5.675708824264124, -0.07719673777808994], [5.624388182669152, -0.08891177178231004], [5.572244962752436, -0.1001700148250327], [5.5193145852145005, -0.11098635108224708], [5.46563247075588, -0.1213756647299416], [5.4112340400770895, -0.1313528399441069], [5.356154713878664, -0.14093276090073137], [5.300429912861128, -0.15013031177580416], [5.244095057725011, -0.15896037674531438], [5.187185569170838, -0.16743783998525125], [5.129736867899138, -0.17557758567160392], [5.071784374610436, -0.18339449798036156], [5.013363510005261, -0.19090346108751327], [4.954509694784139, -0.19811935916904827], [4.895258349647598, -0.20505707640095566], [4.835644895296166, -0.21173149695922466], [4.775704752430368, -0.21815750501984438], [4.715473341750734, -0.22434998475880394], [4.6549860839577875, -0.23032382035209256], [4.594278399752058, -0.23609389597569938], [4.533385709834074, -0.24167509580561355], [4.472343434904359, -0.24708230401782422], [4.411186995663443, -0.2523304047883206], [4.349951812811852, -0.25743428229309173], [4.288673307050117, -0.26240882070812643], [4.22738689907876, -0.26726890420941474], [4.166128009598308, -0.2720294169729453], [4.1049320593092915, -0.27670524317470735], [4.043834468912235, -0.2813112669906899], [3.9828706591076672, -0.2858623725968823], [3.922076050596115, -0.2903734441692735], [3.8614860640781057, -0.29485936588385286], [3.801136120254166, -0.2993350219166094], [3.741061639824824, -0.3038152964435323], [3.681298043490606, -0.3083150736406107], [3.6218807519520393, -0.3128492376838339], [3.562845185909651, -0.3174326727491909], [3.5042267660639688, -0.32208026301267084], [3.4460609131155207, -0.32680689265026297], [3.3883830477648313, -0.33162744583795645], [3.33122859071243, -0.3365568067517404], [3.274632962658843, -0.34160985956760387], [3.2186315843045974, -0.34680148846153624], [3.163259876350221, -0.3521465776095265], [3.108553259496245, -0.3576600111875634], [3.054547154443188, -0.363356673371637], [3.0012769818915808, -0.36925144833773604], [2.948778162541952, -0.3753592202618495], [2.8970861170948274, -0.38169487331996677], [2.846236266250735, -0.3882732916880769], [2.796264030710202, -0.3951093595421691], [2.7472048311737547, -0.4022179610582324], [2.699094088341921, -0.4096139804122561], [2.6519672229152285, -0.4173123017802292], [2.6058596555942035, -0.42532780933814107], [2.5608068070793735, -0.4336753872619807], [2.5168440980712656, -0.44236991972773726], [2.474006949270407, -0.45142629091139996], [2.432330781377325, -0.46085938498895795], [2.3918510150925467, -0.47068408613640034], [2.352603071116599, -0.4809152785297164], [2.3146223701500097, -0.4915678463448951], [2.2779443328933056, -0.5026566737579257], [2.2426043800470166, -0.5141966449447964], [2.2086379323116643, -0.5262026440814983], [2.1760804103877787, -0.5386895553440195], [2.144967234975887, -0.5516722629083493], [2.1153338267765167, -0.5651656509504767], [2.0872156064901946, -0.5791846036463909], [2.0606479948174474, -0.5937440051720813], [2.035038092691026, -0.609798521260583], [2.007848853370123, -0.6312968109441813], [1.9792313722562416, -0.6582812903777567], [1.9496752447018793, -0.6902941072750193], [1.9196700660595292, -0.726877409349678], [1.889705431681686, -0.767573344315443], [1.8602709369208446, -0.8119240598860231], [1.8318561771295, -0.8594717037751282], [1.8049507476601474, -0.9097584236964676], [1.7800442438652808, -0.9623263673637508], [1.757626261097395, -1.0167176824906874], [1.7381863947089853, -1.072474516790987], [1.722214240052546, -1.1291390179783591], [1.7101993924805732, -1.1862533337665089], [1.702631447345559, -1.2433596118691541], [1.7, -1.3]]


def reward_function(params):
    # Read input parameters
    is_reversed = params['is_reversed']
    # all_wheels_on_track = params['all_wheels_on_track']
    # track_width = params['track_width']
    # distance_from_center = params['distance_from_center']
    # speed = params['speed']
    heading = params['heading']
    x = params['x']
    y = params['y']
    progress = params['progress']
    steps = params['steps']

    heading = wrap_360(heading)

    position = [x, y]

    # Give a very low reward by default
    reward = 1e-3

    # max_speed = 6
    best_position, slope = get_best_position(track_waypoints, [x, y])
    best_headings = [wrap_360(math.degrees(direction)) for direction in convert_slope(slope)]

    best_position_diff = get_distance(position, best_position)
    best_heading_diff = min([abs(heading - best_heading) for best_heading in best_headings])

    # Give a high reward if no wheels go off the track and
    # the agent is somewhere in between the track borders
    # if not is_reversed and all_wheels_on_track and (0.5 * track_width - distance_from_center) >= 0.05:
    if not is_reversed:
        reward = 1.0

    if steps:
        # speed_reward = (1 + (speed / max_speed)) ** 2
        position_reward = (1 + (1 - math.tanh(best_position_diff))) ** 2
        heading_reward = (1 + (1 - best_heading_diff / 360)) ** 2
        # reward *= (position_reward * heading_reward + speed_reward) ** 2
        reward *= (position_reward * heading_reward) ** 2
        reward *= (progress / steps) ** 3

    # Always return a float value
    return float(reward)
