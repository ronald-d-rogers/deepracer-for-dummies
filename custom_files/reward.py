import math


def wrap_360(angle):
    angle = angle % 360
    angle = (angle + 360) % 360

    return angle


def convert_slope(m):
    radians = math.atan2(m[1], m[0])
    dir1 = radians
    dir2 = (radians + math.pi) % (2 * math.pi)

    return [dir1, dir2]


def get_distance(p1, p2):
    return math.sqrt((p1[0] - p2[0]) ** 2 + (p1[1] - p2[1]) ** 2)


def get_nearest_point(waypoints, point):
    min_i = None
    min_distance = math.inf

    for i, waypoint in enumerate(waypoints):
        distance = get_distance(waypoint, point)
        if distance < min_distance:
            min_i = i
            min_distance = distance

    return min_i


def get_best_position(waypoints, point):
    i1 = get_nearest_point(waypoints, point)
    p1 = waypoints[i1]

    i2 = i1 + 1
    if i2 > len(waypoints) - 1:
        i2 = 0

    p2 = waypoints[i2]
    m = [p2[0] - p1[0], p2[1] - p1[1]]

    return p1, m


# Chosen optimal waypoints for the track
track_waypoints = [[0.725, 2.5], [0.7270948866313781, 2.486237468609046], [0.7292337456894227, 2.472498115752089], [0.7314167200481015, 2.458782441445137], [0.7336439525813827, 2.445090945704195], [0.7359155861632343, 2.431424128545269], [0.7382317636676242, 2.4177824899843663], [0.7405926279685205, 2.404166530037492], [0.7429983219398913, 2.3905767487206533], [0.7454489884557045, 2.3770136460498565], [0.7479447703899281, 2.3634777220411065], [0.7504858106165302, 2.3499694767104105], [0.7530722520094786, 2.3364894100737748], [0.7557042374427415, 2.323038022147205], [0.758381909790287, 2.309615812946708], [0.7611054119260828, 2.2962232824882896], [0.7638748867240972, 2.2828609307879564], [0.7666904770582982, 2.269529257861714], [0.7695523258026535, 2.2562287637255696], [0.7724605758311315, 2.2429599483955283], [0.7754153700177, 2.229723311887598], [0.7784168512363271, 2.2165193542177826], [0.7814651623609806, 2.20334857540209], [0.7845604462656289, 2.190211475456526], [0.7877028458242398, 2.1771085543970963], [0.790892503910781, 2.164040312239808], [0.7941295633992211, 2.1510072490006675], [0.7974141671635278, 2.1380098646956798], [0.8007464580776689, 2.1250486593408517], [0.8041265790156129, 2.11212413295219], [0.8075546728513275, 2.0992367855456995], [0.8110308824587807, 2.0863871171373884], [0.8145553507119406, 2.0735756277432618], [0.8181282204847753, 2.0608028173793254], [0.8217496346512526, 2.0480691860615865], [0.8254197360853408, 2.0353752338060507], [0.8291386676610075, 2.0227214606287247], [0.832906572252221, 2.010108366545614], [0.8367235927329493, 1.9975364515727256], [0.8405898719771603, 1.985006215726065], [0.8445055528588222, 1.972518159021639], [0.8484707782519028, 1.9600727814754537], [0.8524856910303702, 1.9476705831035155], [0.8565504340681925, 1.9353120639218302], [0.8606651502393375, 1.922997723946404], [0.8648299824177733, 1.910728063193243], [0.8690450734774682, 1.8985035816783544], [0.8733105662923898, 1.8863247794177433], [0.8776266037365063, 1.874192156427417], [0.8819933286837855, 1.862106212723381], [0.8864108840081958, 1.8500674483216415], [0.8908794125837048, 1.8380763632382047], [0.895399057284281, 1.8261334574890773], [0.899969960983892, 1.814239231090265], [0.9045922665565062, 1.8023941840577746], [0.9092661168760909, 1.790598816407612], [0.9139916548166147, 1.7788536281557832], [0.9187690232520455, 1.7671591193182945], [0.9235983650563514, 1.7555157899111526], [0.9284798231035002, 1.743924139950363], [0.93341354026746, 1.732384669451933], [0.9383996594221988, 1.7208978784318676], [0.9434383234416848, 1.7094642669061735], [0.9485296751998856, 1.6980843348908574], [0.9536738575707697, 1.6867585824019249], [0.9588710134283048, 1.6754875094553823], [0.9641212856464588, 1.6642716160672364], [0.9694248170992001, 1.6531114022534927], [0.9747817506604964, 1.6420073680301581], [0.980192229204316, 1.630960013413238], [0.9856563956046266, 1.6199698384187389], [0.9911743927353962, 1.6090373430626679], [0.9967463634705933, 1.5981630273610303], [1.0023724506841851, 1.5873473913298324], [1.0080527972501403, 1.5765909349850806], [1.013787546042427, 1.565894158342781], [1.0195768399350127, 1.5552575614189403], [1.0254208218018652, 1.5446816442295643], [1.0313196345169533, 1.534166906790659], [1.0372734209542447, 1.5237138491182314], [1.0432823239877071, 1.513322971228287], [1.049346486491309, 1.5029947731368318], [1.055466051339018, 1.492729754859873], [1.0616411614048022, 1.4825284164134163], [1.06787195956263, 1.472391257813468], [1.0741585886864686, 1.462318779076034], [1.0805011916502871, 1.4523114802171209], [1.0868999113280526, 1.4423698612527351], [1.0933548905937336, 1.432494422198882], [1.0998662723212977, 1.422685663071569], [1.1064341993847133, 1.4129440838868015], [1.1130588146579483, 1.4032701846605855], [1.1197402610149707, 1.3936644654089283], [1.1264786813297485, 1.3841274261478351], [1.1332742184762497, 1.3746595668933126], [1.1401270153284422, 1.365261387661367], [1.1470372147602943, 1.3559333884680045], [1.1540049596457738, 1.3466760693292308], [1.1610303928588488, 1.3374899302610532], [1.1681136572734874, 1.3283754712794775], [1.175254895763657, 1.3193331924005092], [1.1824542512033265, 1.3103635936401552], [1.1897118664664634, 1.3014671750144218], [1.1970278844270357, 1.2926444365393148], [1.2044024479590116, 1.283895878230841], [1.211835699936359, 1.275222000105006], [1.219327783233046, 1.2666233021778166], [1.2268788407230407, 1.2581002844652787], [1.234489015280311, 1.2496534469833982], [1.2421584497788245, 1.241283289748182], [1.24988728709255, 1.232990312775636], [1.2576756700954548, 1.2247750160817665], [1.2655237416615073, 1.2166378996825797], [1.2734316446646756, 1.2085794635940819], [1.2813995219789274, 1.2006002078322788], [1.289427516478231, 1.1927006324131773], [1.297515771036554, 1.1848812373527835], [1.305664428527865, 1.1771425226671035], [1.3138736318261315, 1.1694849883721434], [1.3221435238053214, 1.1619091344839096], [1.3304742473394033, 1.1544154610184083], [1.3388659453023455, 1.1470044679916456], [1.3473187605681145, 1.139676655419628], [1.35583283601068, 1.1324325233183616], [1.364408314504009, 1.1252725717038523], [1.3730453389220691, 1.1181973005921069], [1.3817440521388298, 1.1112072099991315], [1.3905045970282581, 1.1043027999409318], [1.399327116464322, 1.0974845704335146], [1.4082117533209901, 1.0907530214928858], [1.41715865047223, 1.0841086531350514], [1.426167950792009, 1.0775519653760186], [1.4352397971542965, 1.071083458231793], [1.4443743324330598, 1.0647036317183804], [1.4535716995022672, 1.0584129858517877], [1.4628320412358862, 1.0522120206480208], [1.4721555005078848, 1.0461012361230861], [1.4815422201922317, 1.0400811322929895], [1.4909923431628944, 1.0341522091737376], [1.5005060122938414, 1.0283149667813365], [1.5100833704590402, 1.0225699051317922], [1.5197245605324587, 1.0169175242411115], [1.5294297253880649, 1.0113583241253004], [1.5391990078998277, 1.0058928048003641], [1.5490325509417142, 1.0005214662823105], [1.5589303379425263, 0.9952446392062196], [1.5688914950941673, 0.9900617435519197], [1.5789148617479938, 0.9849718945843433], [1.5889992770506638, 0.9799742073509683], [1.5991435801488347, 0.9750677968992724], [1.6093466101891638, 0.9702517782767334], [1.619607206318308, 0.9655252665308292], [1.6299242076829255, 0.9608873767090373], [1.6402964534296727, 0.9563372238588359], [1.6507227827052082, 0.9518739230277026], [1.661202034656189, 0.9474965892631148], [1.6717330484292732, 0.9432043376125508], [1.6823146631711166, 0.9389962831234883], [1.6929457180283776, 0.934871540843405], [1.7036250521477136, 0.9308292258197784], [1.7143515046757822, 0.9268684531000868], [1.7251239147592412, 0.9229883377318076], [1.735941121544747, 0.9191879947624186], [1.746801964178957, 0.9154665392393981], [1.7577052818085297, 0.9118230862102231], [1.768649913580122, 0.908256750722372], [1.7796346986403908, 0.9047666478233222], [1.790658476135995, 0.9013518925605515], [1.8017200852135897, 0.8980115999815381], [1.8128183650198346, 0.8947448851337594], [1.8239521547013864, 0.8915508630646931], [1.835120293404902, 0.8884286488218173], [1.8463216202770392, 0.8853773574526096], [1.857554974464456, 0.8823961040045477], [1.8688191951138082, 0.8794840035251097], [1.8801131213717546, 0.876640171061773], [1.8914355923849528, 0.8738637216620155], [1.9027854473000594, 0.8711537703733152], [1.9141615252637323, 0.8685094322431497], [1.9255626654226283, 0.8659298223189968], [1.936987706923406, 0.8634140556483342], [1.9484354889127222, 0.8609612472786398], [1.959904850537234, 0.8585705122573913], [1.971394630943599, 0.8562409656320668], [1.9829036692784747, 0.8539717224501434], [1.9944308046885186, 0.8517618977590995], [2.0059748763203884, 0.8496106066064127], [2.017534723320742, 0.8475169640395607], [2.0291091848362344, 0.8454800851060214], [2.040697100013526, 0.8434990848532724], [2.0522973079992726, 0.8415730783287918], [2.0639086479401314, 0.8397011805800569], [2.0755299589827607, 0.8378825066545461], [2.087160080273818, 0.8361161715997367], [2.0987978509599605, 0.8344012904631064], [2.110442110187845, 0.8327369782921337], [2.1220916971041293, 0.8311223501342955], [2.133745450855471, 0.8295565210370702], [2.145402210588528, 0.8280386060479351], [2.1570608154499573, 0.8265677202143684], [2.1687201045864155, 0.8251429785838478], [2.180378917144562, 0.8237634962038509], [2.1920360922710516, 0.8224283881218555], [2.2036904691125443, 0.8211367693853395], [2.2153408868156954, 0.8198877550417807], [2.226986184527164, 0.8186804601386568], [2.2386252013936057, 0.8175139997234456], [2.2502567765616805, 0.816387488843625], [2.261879749178044, 0.8153000425466727], [2.273492958389354, 0.8142507758800662], [2.2850952433422673, 0.8132388038912837], [2.2966854431834425, 0.8122632416278028], [2.3082623970595364, 0.8113232041371014], [2.319824944117207, 0.810417806466657], [2.3313719235031107, 0.8095461636639477], [2.342902174363906, 0.808707390776451], [2.35441453584625, 0.807900602851645], [2.365907847096799, 0.8071249149370072], [2.377380947262212, 0.8063794420800156], [2.388832675489146, 0.8056632993281476], [2.4002618709242585, 0.8049756017288816], [2.4116673727142053, 0.8043154643296948], [2.423048020005646, 0.8036820021780654], [2.434402651945238, 0.8030743303214708], [2.4457301076796374, 0.8024915638073892], [2.4570292263555022, 0.801932817683298], [2.46829884711949, 0.8013972069966753], [2.479537809118258, 0.8008838467949985], [2.4907449514984634, 0.8003918521257458], [2.5019191154134517, 0.7999203385207492], [2.5130597692243315, 0.7994685729010782], [2.5241678958347475, 0.7990361877531738], [2.5352447022004148, 0.7986228696429614], [2.5462913952770534, 0.7982283051363656], [2.5573091820203775, 0.7978521807993123], [2.568299269386105, 0.7974941831977259], [2.5792628643299524, 0.7971539988975322], [2.5902011738076367, 0.7968313144646559], [2.6011154047748746, 0.7965258164650224], [2.6120067641873828, 0.7962371914645567], [2.6228764590008784, 0.7959651260291841], [2.6337256961710778, 0.7957093067248294], [2.6445556826536993, 0.7954694201174182], [2.6553676254044567, 0.7952451527728756], [2.6661627313790697, 0.7950361912571264], [2.676942207533254, 0.7948422221360961], [2.687707260822726, 0.7946629319757097], [2.6984590982032035, 0.7944980073418924], [2.7091989266304024, 0.7943471348005692], [2.71992795306004, 0.7942100009176655], [2.7306473844478334, 0.7940862922591062], [2.7413584277494984, 0.7939756953908166], [2.752062289920752, 0.7938778968787219], [2.762760177917312, 0.7937925832887471], [2.773453298694895, 0.7937194411868175], [2.7841428592092177, 0.7936581571388581], [2.794830066415996, 0.7936084177107943], [2.805516127270947, 0.7935699094685509], [2.8162022487297893, 0.7935423189780534], [2.8268896377482373, 0.7935253328052265], [2.8375795012820095, 0.7935186375159959], [2.8482730462868213, 0.7935219196762865], [2.8589714797183907, 0.7935348658520233], [2.869676008532434, 0.7935571626091317], [2.8803878396846683, 0.7935884965135366], [2.8911081801308103, 0.7936285541311635], [2.9018382368265763, 0.7936770220279371], [2.9125792167276834, 0.793733586769783], [2.9233323267898492, 0.7937979349226261], [2.9340987739687896, 0.7938697530523915], [2.944879765220221, 0.7939487277250045], [2.9556765074998625, 0.7940345455063902], [2.966490207763427, 0.7941268929624737], [2.9773220729666354, 0.7942254566591803], [2.9881733100652026, 0.7943299231624351], [2.9990451260148454, 0.7944399790381632], [3.0099387277712806, 0.7945553108522897], [3.0208553222902252, 0.7946756051707398], [3.031796116527396, 0.7948005485594385], [3.04276231743851, 0.7949298275843115], [3.0537551319792837, 0.7950631288112833], [3.0647757671054343, 0.7952001388062793], [3.075825429772678, 0.7953405441352247], [3.086905326936732, 0.7954840313640447], [3.098016665553313, 0.7956302870586643], [3.1091606525781383, 0.7957789977850087], [3.1203384949669237, 0.7959298501090031], [3.1315513996753874, 0.7960825305965726], [3.142800573659245, 0.7962367258136425], [3.154087223874214, 0.7963921223261377], [3.1654125572760106, 0.7965484066999834], [3.1767777808203523, 0.7967052655011049], [3.1881841014629555, 0.7968623852954273], [3.1996327261595363, 0.7970194526488757], [3.2111248618658137, 0.7971761541273754], [3.2226617155375026, 0.7973321762968513], [3.23424449413032, 0.7974872057232287], [3.2458744045999834, 0.7976409289724329], [3.257552653902209, 0.7977930326103886], [3.269280448992714, 0.7979432032030215], [3.281058996827216, 0.7980911273162563], [3.2928895043614297, 0.7982364915160185], [3.304773178551074, 0.7983789823682329], [3.3167112263518645, 0.7985182864388249], [3.328704854719519, 0.7986540902937197], [3.3407552706097525, 0.7987860804988423], [3.3528636809782837, 0.7989139436201179], [3.365031292780829, 0.7990373662234717], [3.3772593129731034, 0.7991560348748287], [3.389548948510827, 0.7992696361401141], [3.401901406349714, 0.7993778565852533], [3.414317893445482, 0.7994803827761711], [3.426799616753849, 0.7995769012787928], [3.439347783230529, 0.7996670986590436], [3.4519635998312417, 0.7997506614828486], [3.4646482735117026, 0.799827276316133], [3.477403011227628, 0.7998966297248218], [3.490229019934736, 0.7999584082748403], [3.5031275082295923, 0.8000123003641542], [3.5160999000682707, 0.8000582348438002], [3.529148047031635, 0.8000966180162027], [3.5422738511645946, 0.8001279125278646], [3.555479214512055, 0.800152581025289], [3.5687660391189167, 0.8001710861549789], [3.58213622703009, 0.8001838905634371], [3.595591680290478, 0.8001914568971672], [3.609134300944986, 0.8001942478026719], [3.6227659910385213, 0.8001927259264545], [3.6364886526159874, 0.8001873539150177], [3.650304187722291, 0.8001785944148648], [3.6642144984023357, 0.8001669100724991], [3.6782214867010286, 0.8001527635344231], [3.6923270546632745, 0.8001366174471403], [3.7065331043339786, 0.8001189344571535], [3.720841537758048, 0.8001001772109662], [3.735254256980384, 0.8000808083550809], [3.7497731640458967, 0.8000612905360011], [3.76440016099949, 0.8000420864002293], [3.779137149886066, 0.8000236585942693], [3.7939860327505355, 0.8000064697646236], [3.808948776194889, 0.7999909631753924], [3.8240283237862562, 0.79997728876995], [3.839228376827302, 0.7999653689917037], [3.854552656442372, 0.7999551203328646], [3.8700048837558163, 0.7999464592856439], [3.885588779891981, 0.7999393023422525], [3.901308065975216, 0.7999335659949018], [3.917166463129866, 0.7999291667358026], [3.933167692480283, 0.7999260210571664], [3.9493154751508133, 0.7999240454512039], [3.9656135322658033, 0.7999231564101265], [3.9820655849496043, 0.7999232704261452], [3.9986753543265614, 0.7999243039914711], [4.015446561521024, 0.7999261735983153], [4.0323829276573395, 0.7999287957388892], [4.049488173859856, 0.7999320869054034], [4.0667660212529215, 0.7999359635900696], [4.084220190960884, 0.7999403422850984], [4.1018544041080895, 0.7999451394827012], [4.119672381818891, 0.799950271675089], [4.137677845217633, 0.799955655354473], [4.155874515428664, 0.7999612070130643], [4.174266113576332, 0.7999668431430739], [4.192856360784983, 0.7999724802367131], [4.21164897817897, 0.7999780347861929], [4.230647686882636, 0.7999834232837244], [4.249856208020333, 0.7999885622215188], [4.269278262716404, 0.7999933680917871], [4.288917572095203, 0.7999977573867406], [4.308777939458441, 0.8000016426698197], [4.328865711862749, 0.8000048148915508], [4.349190206961608, 0.8000069229829055], [4.369760910598711, 0.8000076078339456], [4.390587308617768, 0.8000065103347334], [4.411678886862471, 0.8000032713753307], [4.433045028135535, 0.7999975578164311], [4.454690447864662, 0.7999902128921514], [4.476613385160782, 0.7999837121388966], [4.498811602093231, 0.7999806513274772], [4.521282860731343, 0.7999836262287038], [4.544024923144453, 0.7999952326133868], [4.567038920817072, 0.8000171408146663], [4.590356391356752, 0.8000426698731885], [4.614024998070947, 0.8000607097731136], [4.638092552213232, 0.8000601098639767], [4.662606865037187, 0.8000297194953133], [4.687611552546388, 0.7999596036821789], [4.7130545772723655, 0.7998675451269404], [4.7387887111297395, 0.7997989100968774], [4.764662623354809, 0.7998002537001124], [4.790524983183885, 0.7999181310447679], [4.816259693788927, 0.8001806624276964], [4.842215776598324, 0.8003726127806063], [4.869070988314819, 0.8001067488570673], [4.8975100089912935, 0.7989922150320867], [4.928217518680628, 0.7966381556806718], [4.961878197435707, 0.7926537151778298], [4.999176725309411, 0.7866480378985677], [5.040797782354624, 0.7782302682178927], [5.087426048624219, 0.7670095505108134], [5.139746204171089, 0.7525950291523354], [5.198442929048113, 0.7345958485174652], [5.264200903308162, 0.7126211529812143], [5.337631765327198, 0.6863280442577006], [5.41766093246727, 0.6564807546250839], [5.50152411458545, 0.6249529360684638], [5.586383282562709, 0.5936666557412528], [5.669400407280011, 0.5645439807968636], [5.74773745961833, 0.5395069783887091], [5.81857289869139, 0.5204661591587648], [5.880663853365394, 0.5082255528231319], [5.9356316882297735, 0.501581662070788], [5.985400335561584, 0.4991189215666115], [6.03189372763786, 0.49942176597548293], [6.076962172849691, 0.5011277522702415], [6.12135482901358, 0.5036689575605323], [6.164973431943296, 0.5070889047119926], [6.207697933014029, 0.5114468348539727], [6.249408283600967, 0.5168019891158234], [6.289984435079301, 0.5232136086268956], [6.329318450493504, 0.530733642497254], [6.367408368259279, 0.5393502357128002], [6.404307030690896, 0.5490185377180381], [6.440067740173893, 0.5596934209643935], [6.4747437990937975, 0.5713297579032889], [6.508388509836158, 0.5838824209861524], [6.541055174786504, 0.5973062826644063], [6.572797096330371, 0.6115562153894754], [6.603667576853303, 0.6265870916127875], [6.63371991874083, 0.6423537837857644], [6.663007424378491, 0.6588111643598321], [6.691583396151822, 0.6759141057864154], [6.719501136446362, 0.6936174805169406], [6.746813947647642, 0.7118761610028285], [6.773575132141205, 0.7306450196955079], [6.799837992312586, 0.7498789290464037], [6.825640453916363, 0.769539703495584], [6.850957776943658, 0.7896174487921801], [6.875749259693493, 0.8101094768077469], [6.899974200461118, 0.831013099415548], [6.92359189754179, 0.8523256284888518], [6.946561649230755, 0.874044375900918], [6.968842753823263, 0.8961666535250119], [6.990394509614566, 0.9186897732343972], [7.011176214899914, 0.9416110469023379], [7.0311471679745585, 0.9649277864020981], [7.05026666713375, 0.9886373036069417], [7.0684940106727385, 1.0127369103901342], [7.085788496886773, 1.0372239186249346], [7.102109424071107, 1.0620956401846116], [7.11741609052099, 1.0873493869424293], [7.131667794531672, 1.1129824707716465], [7.144823834398404, 1.1389922035455342], [7.1568454109928386, 1.1653754666061116], [7.167724443467261, 1.1921221901004715], [7.1774777043470985, 1.2192166801421396], [7.186122679223057, 1.246643081486137], [7.193676853685843, 1.2743855388874852], [7.200157713326165, 1.3024281971012068], [7.205582743734733, 1.3307552008823225], [7.209969430502252, 1.3593506949858547], [7.213335259219431, 1.3881988241668244], [7.215697715476977, 1.417283733180256], [7.217074284865596, 1.4465895667811646], [7.217482452975998, 1.476100469724578], [7.21693970539889, 1.5058005867655184], [7.215463527724981, 1.5356740626590026], [7.213071405544975, 1.565705042160055], [7.209780824449583, 1.5958776700236967], [7.205609270029511, 1.62617609100495], [7.200574227875467, 1.656584449858836], [7.194693183578159, 1.687086891340377], [7.187983622728295, 1.7176675602045943], [7.180463030916581, 1.7483106012065093], [7.172148893733726, 1.7790001591011464], [7.163058696770436, 1.8097203786435228], [7.153209925617422, 1.8404554045886599], [7.14261359558497, 1.871188640659708], [7.13121140561141, 1.9018955518757648], [7.118902985611383, 1.93254678515137], [7.105587374384798, 1.9631129197015447], [7.091163610731561, 1.9935645347413082], [7.075530733451582, 2.023872209485681], [7.058587781344764, 2.054006523149684], [7.040233793211015, 2.0839380549483386], [7.0203678078502465, 2.1136373840966596], [6.998888864062361, 2.1430750898096727], [6.975696000647264, 2.1722217513023994], [6.95068825640487, 2.2010479477898524], [6.923764670135078, 2.2295242584870607], [6.894824280637802, 2.2576212626090393], [6.863766126712946, 2.2853095393708065], [6.830489247160414, 2.3125596679873914], [6.794892680780119, 2.3393422276738054], [6.756875466371965, 2.365627797645072], [6.71633664273586, 2.391386957116212], [6.673175248671708, 2.416590285302247], [6.627290322979425, 2.4412083614181914], [6.578580904458909, 2.4652117646790717], [6.526946031910068, 2.4885710742999074], [6.472295561934467, 2.511257767652698], [6.414788160571705, 2.533263979720052], [6.354831303299418, 2.5546025030951767], [6.292843283396905, 2.5752870285282627], [6.229242394143446, 2.5953312467695038], [6.164446928818331, 2.6147488485690924], [6.098875180700872, 2.6335535246772137], [6.032945443070345, 2.6517589658440635], [5.967076009206045, 2.669378862819832], [5.901685172387265, 2.686426906354711], [5.837191225893292, 2.702916787198892], [5.774012463003427, 2.7188621961025645], [5.712567176996961, 2.73427682381592], [5.653273661153179, 2.749174361089151], [5.596479139410094, 2.7635692361535646], [5.542194007334044, 2.7774793724827047], [5.490328974120095, 2.790923727987959], [5.4407947337555695, 2.803921260738528], [5.393501980227794, 2.8164909288036095], [5.348361407524098, 2.828651690252403], [5.305283709631797, 2.8404225031541106], [5.264179580538234, 2.8518223255779267], [5.2249597142307245, 2.862870115593053], [5.187534804696596, 2.873584831268688], [5.151815545923179, 2.883985430674031], [5.117712631897794, 2.894090871878281], [5.085136756607773, 2.9039201129506367], [5.0539986140404425, 2.913492111960298], [5.024208898183127, 2.922825826976463], [4.995678303023151, 2.9319402160683308], [4.968317522547843, 2.940854237305102], [4.942037250744529, 2.9495868487559744], [4.916748181600537, 2.9581570084901467], [4.892361009103193, 2.9665836745768193], [4.868786427239825, 2.9748858050851896], [4.845935129997751, 2.9830823580844594], [4.8237178113643076, 2.991192291643825], [4.8020451653268195, 2.9992345638324855], [4.780837866501705, 3.0072259236072147], [4.760069841762941, 3.0151713330701826], [4.739732706715232, 3.0230718390999307], [4.719818088723225, 3.0309284859720558], [4.700317615151567, 3.0387423179621518], [4.681222913364905, 3.0465143793458145], [4.662525610727879, 3.0542457143986415], [4.644217334605141, 3.061937367396227], [4.626289712361337, 3.0695903826141673], [4.608734371361112, 3.077205804328058], [4.591542938969112, 3.0847846768134946], [4.574707042549983, 3.0923280443460732], [4.558218309468373, 3.0998369512013886], [4.542068367088928, 3.1073124416550373], [4.526248842776294, 3.114755559982614], [4.510751363895116, 3.122167350459716], [4.495567557810039, 3.1295488573619394], [4.480689051885713, 3.1369011249648775], [4.466107473486783, 3.144225197544127], [4.451814449977895, 3.1515221193752843], [4.437801608723695, 3.1587929347339445], [4.424060577088829, 3.166038687895704], [4.410582982437944, 3.1732604231361576], [4.397360452135687, 3.1804591847309003], [4.384384613546703, 3.1876360169555302], [4.371647094035638, 3.194791964085641], [4.359139533680914, 3.20192806961646], [4.34685483960416, 3.2090452992722254], [4.334788245809251, 3.2161444759533797], [4.322935235857799, 3.2232264072425343], [4.311291293311417, 3.230291900722303], [4.299851901731715, 3.2373417639752993], [4.288612544680312, 3.244376804584131], [4.277568705718815, 3.251397830131414], [4.26671586840884, 3.25840564819976], [4.2560495163119985, 3.265401066371781], [4.245565132989901, 3.272384892230091], [4.2352582020041645, 3.2793579333572995], [4.2251242069164, 3.2863209973360195], [4.215158631288217, 3.2932748917488652], [4.205356958681231, 3.3002204241784474], [4.195714672657054, 3.3071584022073797], [4.1862272567773, 3.3140896334182735], [4.17689019460358, 3.3210149253937407], [4.167698969697508, 3.3279350857163945], [4.158649065620696, 3.334850921968847], [4.149735965934755, 3.341763241733711], [4.140955154201302, 3.348672852593598], [4.132302113981945, 3.355580562131121], [4.1237723288382995, 3.3624871779288923], [4.1153612823319765, 3.369393507569524], [4.107064458024589, 3.376300358635629], [4.09887733947775, 3.3832085387098183], [4.090795410253072, 3.390118855374706], [4.08281415391217, 3.3970321162129027], [4.0749290540166525, 3.4039491288070223], [4.0671355941281355, 3.410870700739677], [4.05942925780823, 3.417797639593478], [4.051805528618548, 3.4247307529510387], [4.044259890120704, 3.431670848394971], [4.036787825876309, 3.438618733507887], [4.029384819446977, 3.4455752158724007], [4.022046354394321, 3.4525411030711224], [4.014767914279952, 3.4595172026866643], [4.0075449826654825, 3.466504322301641], [4.0003730431125275, 3.4735032694986625], [3.9932475791826967, 3.4805148518603435], [3.9861640744376063, 3.487539876969294], [3.9791180124388656, 3.494579152408128], [3.9721048767480895, 3.5016334857594567], [3.9651201509268885, 3.5087036846058943], [3.9581593185368784, 3.515790556530051], [3.951217863139669, 3.522894909114539], [3.9442912682968743, 3.530017549941973], [3.9373750175701066, 3.5371592865949633], [3.930464594520977, 3.5443209266561237], [3.9235554886777977, 3.551503275421397], [3.916644319890402, 3.558706705003769], [3.909730166798258, 3.565930645212871], [3.902812431165483, 3.5731744020244642], [3.895890514756194, 3.580437281414309], [3.8889638193345126, 3.5877185893581625], [3.882031746664556, 3.595017631831787], [3.8750936985104416, 3.6023337148109396], [3.8681490766362887, 3.609666144271382], [3.861197282806215, 3.617014226188874], [3.8542377187843404, 3.6243772665391742], [3.8472697863347824, 3.6317545712980417], [3.840292887221659, 3.639145446441237], [3.833306423209089, 3.64654919794452], [3.8263097960611905, 3.6539651317836506], [3.8193024075420827, 3.661392553934387], [3.8122836594158835, 3.6688307703724905], [3.805252953446711, 3.6762790870737194], [3.798209691398685, 3.683736810013834], [3.791153275035921, 3.691203245168596], [3.784083106122541, 3.698677698513761], [3.776998586422661, 3.7061594760250913], [3.7698991177004, 3.7136478836783455], [3.7627841017198778, 3.7211422274492834], [3.755652940245209, 3.728641813313667], [3.748505035040517, 3.7361459472472522], [3.741339787869917, 3.7436539352258], [3.7341566004975273, 3.7511650832250716], [3.7269548746874683, 3.758678697220825], [3.7197340122038565, 3.7661940831888208], [3.712493414810811, 3.7737105471048187], [3.7052324842724507, 3.781227394944577], [3.6979506223528946, 3.7887439326838557], [3.6906472308162583, 3.7962594662984164], [3.6833217114266628, 3.803773301764017], [3.6759734659482266, 3.8112847450564167], [3.668601896145066, 3.8187931021513775], [3.661206403781302, 3.826297679024656], [3.6537863906210513, 3.8337977816520126], [3.646341258428431, 3.841292716009211], [3.638870408967563, 3.8487817880720057], [3.6313732440025643, 3.856264303816158], [3.6238491652975515, 3.8637395692174286], [3.6162975746166457, 3.8712068902515755], [3.608717873723963, 3.8786655728943606], [3.601109464383623, 3.886114923121542], [3.593471748359745, 3.893554246908878], [3.5858041274164467, 3.900982850232131], [3.5781060033178447, 3.9084000390670606], [3.570376777828059, 3.9158051193894243], [3.5626158527112084, 3.9231973971749827], [3.5548226297314107, 3.930576178399496], [3.5469965106527854, 3.9379407690387223], [3.53913689723945, 3.945290475068423], [3.53124319125552, 3.9526246024643594], [3.5233147944651195, 3.9599424572022865], [3.5153511086323643, 3.967243345257966], [3.507351535521371, 3.9745265726071595], [3.4993154768962613, 3.981791445225624], [3.4912423345211505, 3.9890372690891214], [3.4831315101601583, 3.99626335017341], [3.474982405577405, 4.0034689944542485], [3.466794422537007, 4.010653507907398], [3.45856696280308, 4.01781619650862], [3.4502994281397483, 4.02495636623367], [3.4419912203111274, 4.0320733230583095], [3.4336417410813347, 4.0391663729583], [3.4252503922144912, 4.046234821909398], [3.4168165754747113, 4.053277975887366], [3.408339692626117, 4.060295140867963], [3.399819145432826, 4.0672856228269465], [3.391254335658957, 4.074248727740077], [3.3826446650686264, 4.081183761583117], [3.3739895354259533, 4.088090030331823], [3.365288348495058, 4.094966839961955], [3.3565405060400573, 4.1018134964492745], [3.34774540982507, 4.108629305769539], [3.3389024616142153, 4.1154135738985085], [3.330011063171608, 4.122165606811945], [3.321070616261372, 4.128884710485607], [3.312080522647623, 4.135570190895252], [3.3030401840944776, 4.142221354016642], [3.2939490023660576, 4.148837505825536], [3.284806379226479, 4.155417952297693], [3.27561171643986, 4.161961999408874], [3.2663644157703224, 4.168468953134837], [3.257063878981982, 4.174938119451343], [3.2477095078389557, 4.181368804334151], [3.2383007041053635, 4.187760313759022], [3.2288368695453267, 4.194111953701714], [3.219317405922958, 4.200423030137989], [3.2097417150023815, 4.206692849043602], [3.2001091985477106, 4.212920716394317], [3.190419258323067, 4.219105938165892], [3.180671296092569, 4.2252478203340855], [3.170864713620334, 4.23134566887466], [3.160998912670479, 4.237398789763374], [3.1510732950071256, 4.243406488975985], [3.1410872623943895, 4.249368072488257], [3.13104021659639, 4.2552828462759456], [3.1209315593772478, 4.261150116314812], [3.1107606925010765, 4.2669691885806165], [3.100527017732, 4.272739369049117], [3.0902299368341315, 4.2784599636960765], [3.079868851571594, 4.28413027849725], [3.069443163708502, 4.2897496194284015], [3.0589522750089775, 4.295317292465287], [3.048395587989185, 4.300832603501919], [3.0377728319343262, 4.306294822910801], [3.0270845723925053, 4.311703130158299], [3.016331506791304, 4.317056690374789], [3.0055143325583136, 4.322354668690646], [2.9946337471211173, 4.327596230236247], [2.9836904479073, 4.332780540141967], [2.9726851323444485, 4.337906763538182], [2.9616184978601523, 4.342974065555267], [2.950491241881992, 4.347981611323599], [2.939304061837558, 4.352928565973553], [2.9280576551544337, 4.357814094635505], [2.9167527192602054, 4.362637362439831], [2.905389951582462, 4.367397534516906], [2.8939700495487877, 4.372093775997106], [2.8824937105867665, 4.376725252010809], [2.8709616321239864, 4.381291127688388], [2.859374511588035, 4.385790568160219], [2.8477330464064945, 4.390222738556679], [2.8360379340069555, 4.394586804008143], [2.8242898718169998, 4.398881929644988], [2.8124895572642155, 4.403107280597587], [2.80063768777619, 4.407262021996319], [2.7887349607805074, 4.411345318971557], [2.776782073704754, 4.41535633665368], [2.764779723976515, 4.419294240173061], [2.75272860902338, 4.423158194660076], [2.7406294262729305, 4.426947365245103], [2.7284828731527564, 4.430660917058515], [2.7162896470904423, 4.434298015230689], [2.7040504455135705, 4.437857824892003], [2.691765965849734, 4.441339511172828], [2.679436905526516, 4.444742239203543], [2.6670639619714995, 4.4480651741145225], [2.654647832612275, 4.451307481036143], [2.6421892148764248, 4.454468325098783], [2.629688806191537, 4.457546871432814], [2.617147303985199, 4.4605422851686125], [2.604565405684995, 4.463453731436554], [2.59194380871851, 4.466280375367017], [2.579283210513332, 4.469021382090376], [2.566584308497047, 4.471675916737006], [2.5538478000972398, 4.474243144437282], [2.5410743805967266, 4.4767222641641595], [2.528264723017079, 4.479112826152901], [2.5154194871923825, 4.481414588725441], [2.502539332784159, 4.483627312926741], [2.4896249194539197, 4.485750759801767], [2.476676906863178, 4.487784690395486], [2.463695954673454, 4.489728865752865], [2.450682722546259, 4.491583046918867], [2.4376378701431096, 4.493346994938459], [2.424562057125522, 4.495020470856607], [2.4114559431550115, 4.4966032357182755], [2.398320187893091, 4.498095050568432], [2.3851554510012765, 4.499495676452041], [2.3719623921410866, 4.500804874414069], [2.358741670974032, 4.50202240549948], [2.345493947161632, 4.503148030753242], [2.3322198803654, 4.504181511220319], [2.3189201302468474, 4.505122607945679], [2.305595356467497, 4.505971081974285], [2.292246218688861, 4.506726694351104], [2.2788733765724514, 4.507389206121103], [2.265477489779789, 4.507958378329245], [2.2520592179723837, 4.508433972020497], [2.2386192208117532, 4.508815748239826], [2.2251581579594153, 4.509103468032196], [2.211676689076882, 4.509296892442575], [2.1981754738256685, 4.5093957825159245], [2.184655171867291, 4.509399899297214], [2.171116442863266, 4.509309003831409], [2.1575599464751063, 4.509122857163474], [2.14398634236433, 4.508841220338374], [2.13039629019245, 4.508463854401076], [2.116790449620981, 4.507990520396546], [2.1031694803114425, 4.5074209793697495], [2.0895340419253468, 4.506754992365652], [2.0758847941242076, 4.505992320429219], [2.062222396569543, 4.505132724605416], [2.048547508922866, 4.50417596593921], [2.0348607908456935, 4.503121805475566], [2.021162901999542, 4.501970004259449], [2.007454502045925, 4.500720323335827], [1.9937362621496655, 4.499372507900129], [1.9800091810609193, 4.497925851793045], [1.9662746244899156, 4.496379143249039], [1.9525339775569686, 4.494731143758906], [1.9387886253823978, 4.492980614813442], [1.9250399530865148, 4.491126317903446], [1.911289345789637, 4.4891670145197144], [1.8975381886120823, 4.487101466153044], [1.8837878666741645, 4.4849284342942335], [1.8700397650961966, 4.482646680434078], [1.8562952689984973, 4.480254966063373], [1.842555763501383, 4.477752052672919], [1.8288226337251663, 4.475136701753511], [1.8150972647901664, 4.4724076747959485], [1.8013810418166953, 4.469563733291025], [1.7876753499250704, 4.466603638729539], [1.7739815742356093, 4.463526152602287], [1.7603010998686257, 4.460330036400068], [1.746635311944433, 4.457014051613676], [1.7329855955833515, 4.45357695973391], [1.7193533359056923, 4.450017522251566], [1.7057399180317732, 4.446334500657443], [1.6921467270819115, 4.442526656442336], [1.6785751481764195, 4.438592751097042], [1.6650265664356163, 4.4345315461123604], [1.6515023669798137, 4.430341802979084], [1.6380039349293316, 4.426022283188014], [1.6245326554044817, 4.421571748229945], [1.611089913525583, 4.416988959595674], [1.5976770944129475, 4.412272678775999], [1.5842955831868932, 4.407421667261716], [1.5709467649677369, 4.402434686543623], [1.557632024875791, 4.397310498112517], [1.544352748031375, 4.392047863459195], [1.5311103195548024, 4.386645544074454], [1.517906124566387, 4.381102301449089], [1.5047415481864463, 4.375416897073899], [1.4916179755352978, 4.369588092439681], [1.4785367917332537, 4.363614649037231], [1.4654993819006328, 4.357495328357348], [1.4525071311577475, 4.351228891890827], [1.439563803274672, 4.344817104203248], [1.426676120604468, 4.338266319513304], [1.4138465929550679, 4.331578280114673], [1.4010775996135862, 4.324754573306375], [1.388371519867142, 4.3177967863874365], [1.3757307330028534, 4.310706506656877], [1.363157618307834, 4.303485321413717], [1.350654555069204, 4.296134817956983], [1.3382239225740782, 4.288656583585695], [1.32586810010957, 4.281052205598872], [1.3135894669628037, 4.27332327129554], [1.3013904024208918, 4.265471367974722], [1.2892732857709501, 4.257498082935435], [1.277240496300098, 4.249405003476707], [1.2652944132954498, 4.241193716897556], [1.2534374160441233, 4.232865810497006], [1.2416718838332372, 4.22442287157408], [1.2300001959499067, 4.215866487427799], [1.218424731681245, 4.207198245357183], [1.2069478703143763, 4.198419732661257], [1.1955719911364129, 4.189532536639045], [1.1842994734344707, 4.180538244589563], [1.1731326964956699, 4.171438443811839], [1.1620740396071236, 4.162234721604892], [1.1511258820559502, 4.152928665267745], [1.1402906031292683, 4.143521862099421], [1.1295705821141933, 4.134015899398941], [1.1189681982978399, 4.124412364465326], [1.1084858309673267, 4.1147128445976], [1.0981258594097723, 4.104918927094786], [1.0878906629122902, 4.095032199255904], [1.077782620762, 4.085054248379977], [1.0678041122460173, 4.0749866617660295], [1.057957516651456, 4.064831026713077], [1.0482452132654385, 4.054588930520149], [1.038669581375079, 4.044261960486264], [1.0292330002674923, 4.033851703910444], [1.0199378492297986, 4.023359748091714], [1.0107865075491116, 4.01278768032909], [1.0017813545125496, 4.002137087921601], [0.9929244872514144, 3.991409497128676], [0.9842159190358535, 3.9806059834019862], [0.9756547297090681, 3.9697274202622266], [0.9672399947234159, 3.9587746802802135], [0.9589707895312544, 3.9477486360267595], [0.9508461895849378, 3.9366501600726758], [0.9428652703368248, 3.925480124988778], [0.9350271072392706, 3.914239403345878], [0.9273307757446296, 3.902928867714785], [0.9197753513052624, 3.8915493906663188], [0.9123599093735237, 3.8801018447712896], [0.9050835254017685, 3.868587102600508], [0.8979452748423555, 3.8570060367247905], [0.8909442331476388, 3.845359519714948], [0.8840794757699765, 3.8336484241417934], [0.8773500781617253, 3.8218736225761423], [0.870755115775241, 3.8100359875888063], [0.8642936640628792, 3.7981363917505964], [0.8579647984769972, 3.7861757076323266], [0.8517675944699522, 3.7741548078048135], [0.8457011274940993, 3.7620745648388647], [0.8397644730017959, 3.749935851305298], [0.8339567064453975, 3.737739539774923], [0.8282769032772611, 3.725486502818553], [0.8227241389497438, 3.7131776130070038], [0.8172974889152015, 3.700813742911087], [0.8119960286259897, 3.6883957651016135], [0.8068188335344664, 3.6759245521494006], [0.8017649790929865, 3.6634009766252564], [0.7968335407539073, 3.6508259110999957], [0.7920235939695861, 3.638200228144435], [0.787334214192378, 3.625524800329384], [0.7827644768746396, 3.6128005002256542], [0.7783134574687275, 3.600028200404061], [0.7739802314269989, 3.587208773435419], [0.769763874201809, 3.5743430918905377], [0.7656634612455153, 3.561432028340233], [0.7616780680104734, 3.548476455355315], [0.7578067699490402, 3.535477245506599], [0.7540486425135724, 3.5224352713648988], [0.7504027611564261, 3.5093514055010258], [0.7468682013299575, 3.496226520485792], [0.7434440384865239, 3.4830614888900135], [0.7401293480784803, 3.4698571832844993], [0.7369232055581841, 3.456614476240065], [0.7338246863779921, 3.443334240327525], [0.7308328659902599, 3.4300173481176888], [0.7279468198473443, 3.416664672181371], [0.7251656234016023, 3.4032770850893876], [0.7224883521053899, 3.3898554594125483], [0.7199140814110628, 3.3764006677216654], [0.7174418867709784, 3.3629135825875545], [0.7150708436374928, 3.3493950765810254], [0.7128000274629623, 3.3358460222728934], [0.7106285136997439, 3.322267292233974], [0.7085553778001934, 3.308659759035075], [0.7065796952166677, 3.2950242952470132], [0.7047005414015229, 3.281361773440599], [0.7029169918071159, 3.2676730661866484], [0.7012281218858023, 3.2539590460559715], [0.6996330070899397, 3.2402205856193844], [0.6981307228718834, 3.226458557447696], [0.6967203446839908, 3.212673834111722], [0.6954009479786177, 3.1988672881822775], [0.6941716082081207, 3.1850397922301705], [0.6930314008248566, 3.171192218826219], [0.6919794012811814, 3.1573254405412334], [0.6910146850294515, 3.1434403299460256], [0.6901363275220236, 3.12953775961141], [0.6893434042112542, 3.1156186021082015], [0.6886349905494995, 3.101683730007209], [0.6880101619891164, 3.0877340158792506], [0.6874679939824607, 3.0737703322951337], [0.6870075619818891, 3.0597935518256745], [0.6866279414397581, 3.0458045470416883], [0.6863282078084243, 3.031804190513985], [0.6861074365402439, 3.017793354813376], [0.6859647030875734, 3.0037729125106774], [0.6858990829027695, 2.9897437361767025], [0.6859096514381879, 2.975706698382262], [0.685995484146186, 2.9616626716981718], [0.6861556564791196, 2.947612528695243], [0.6863892438893455, 2.9335571419442847], [0.6866953218292198, 2.9194973840161187], [0.6870729657510992, 2.905434127481553], [0.6875212511073401, 2.8913682449113995], [0.6880392533502989, 2.877300608876474], [0.6886260479323318, 2.863232091947587], [0.689280710305796, 2.849163566695552], [0.6900023159230471, 2.8350959056911855], [0.6907899402364419, 2.821029981505298], [0.6916426586983369, 2.8069666667087003], [0.6925595467610886, 2.792906833872208], [0.693539679877053, 2.7788513555666348], [0.6945821334985871, 2.764801104362791], [0.695685983078047, 2.7507569528314937], [0.6968503040677891, 2.7367197735435536], [0.6980741719201706, 2.722690439069779], [0.6993566620875467, 2.7086698219809913], [0.7006968500222744, 2.6946587948480003], [0.7020938111767108, 2.680658230241616], [0.7035466210032112, 2.6666690007326563], [0.7050543549541329, 2.65269197889193], [0.7066160884818321, 2.6387280372902517], [0.7082308970386649, 2.6247780484984364], [0.7098978560769881, 2.6108428850872953], [0.7116160410491585, 2.5969234196276387], [0.7133845274075318, 2.5830205246902853], [0.7152023906044644, 2.5691350728460463], [0.7170687060923139, 2.5552679366657305], [0.7189825493234352, 2.5414199887201576], [0.720942995750186, 2.5275921015801344], [0.7229491208249222, 2.5137851478164768], [0.725, 2.5]]


def reward_function(params):
    # Read input parameters
    is_reversed = params['is_reversed']
    all_wheels_on_track = params['all_wheels_on_track']
    track_width = params['track_width']
    distance_from_center = params['distance_from_center']
    # speed = params['speed']
    heading = params['heading']
    x = params['x']
    y = params['y']
    progress = params['progress']
    steps = params['steps']

    heading = wrap_360(heading)

    position = [x, y]

    # Give a very low reward by default
    reward = 1e-3

    # max_speed = 6
    best_position, slope = get_best_position(track_waypoints, [x, y])
    best_headings = [wrap_360(math.degrees(direction)) for direction in convert_slope(slope)]

    best_position_diff = get_distance(position, best_position)
    best_heading_diff = min([abs(heading - best_heading) for best_heading in best_headings])

    # Give a high reward if no wheels go off the track and
    # the agent is somewhere in between the track borders
    if not is_reversed and all_wheels_on_track and (0.5 * track_width - distance_from_center) >= 0.05:
        reward = 1.0

    if steps:
        # speed_reward = (1 + (speed / max_speed)) ** 2
        position_reward = (1 + (1 - math.tanh(best_position_diff))) ** 2
        heading_reward = (1 + (1 - best_heading_diff / 360)) ** 2
        # reward *= (position_reward * heading_reward + speed_reward) ** 2
        reward *= (position_reward * heading_reward) ** 2
        reward *= (progress / steps) ** 2

    # Always return a float value
    return float(reward)
